// AI RFP Builder â€” Dynamic Conversation Engine v8
// í•µì‹¬ ë³€ê²½: ê³ ì • 7ë‹¨ê³„ â†’ ë§¥ë½ ê¸°ë°˜ ë™ì  ì§ˆë¬¸ ìƒì„±
// ì• ì§ˆë¬¸ì˜ ë‹µë³€ì— ë”°ë¼ ë’· ì§ˆë¬¸ì´ ìë™ìœ¼ë¡œ ë§ì¶¤ ìƒì„±ë¨
// ìœ„ì‹œì¼“ 13ë…„ 7ë§Œ+ ì™¸ì£¼ í”„ë¡œì íŠ¸ ë°ì´í„° ê¸°ë°˜

import { RFPData, TopicId, TOPIC_TO_STEP, STEP_TO_TOPIC, getTopicsCovered, isReadyToComplete, TOPICS } from '@/types/rfp';

interface SelectableFeature {
  name: string;
  desc: string;
  category: 'must' | 'recommended';
}

interface FallbackResponse {
  message: string;
  rfpUpdate: {
    section: string;
    value: string | { name: string; description: string; priority: string }[];
  } | null;
  nextAction: string;
  nextStep: number | null;
  quickReplies?: string[];
  selectableFeatures?: SelectableFeature[];
  thinkingLabel?: string;
  topicsCovered?: TopicId[];
  progress?: number;
  canComplete?: boolean;
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  í”„ë¡œì íŠ¸ ìœ í˜• ì¸í…”ë¦¬ì „ìŠ¤ DB (ê¸°ì¡´ ìœ ì§€)
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
interface ProjectTypeInfo {
  type: string;
  avgBudget: string;
  avgDuration: string;
  successRate: string;
  keyFeatures: string[];
  mustHaveFeatures: string[];
  commonMistakes: string[];
  techTip: string;
  commonRisk: string;
  insightEmoji: string;
  marketInsight: string;
  mvpScope: string;
  competitorExample: string;
  // ë™ì  ì§ˆë¬¸ìš© ì¶”ê°€ í•„ë“œ
  topicPriority: TopicId[];        // ì´ ìœ í˜•ì— ë§ëŠ” í† í”½ ìˆœì„œ
  deepDiveQuestions: Record<TopicId, string[]>; // í† í”½ë³„ ì‹¬í™” ì§ˆë¬¸
  quickRepliesMap: Record<TopicId, string[]>;   // í† í”½ë³„ í€µ ë¦¬í”Œë¼ì´
}

const PROJECT_TYPES: Record<string, ProjectTypeInfo> = {
  'ëª¨ë°”ì¼ ì•±': {
    type: 'ëª¨ë°”ì¼ ì•±',
    avgBudget: '2,000~5,000ë§Œì›',
    avgDuration: '4~8ì£¼(MVP)',
    successRate: '73%',
    keyFeatures: ['íšŒì›ê°€ì…/ë¡œê·¸ì¸', 'í‘¸ì‹œ ì•Œë¦¼', 'ë§ˆì´í˜ì´ì§€'],
    mustHaveFeatures: ['ì†Œì…œ ë¡œê·¸ì¸(ì¹´ì¹´ì˜¤/ë„¤ì´ë²„)', 'í‘¸ì‹œ ì•Œë¦¼', 'ì•± ì—…ë°ì´íŠ¸ ê´€ë¦¬'],
    commonMistakes: ['ì•±ìŠ¤í† ì–´ ì‹¬ì‚¬ ê¸°ê°„(1~2ì£¼) ë¯¸ë°˜ì˜', 'ë””ë°”ì´ìŠ¤ íŒŒí¸í™” ëŒ€ì‘ ë¯¸ê³ ë ¤', 'ì˜¤í”„ë¼ì¸ ëª¨ë“œ ë¯¸ì„¤ê³„'],
    techTip: 'Flutter/React Native í¬ë¡œìŠ¤í”Œë«í¼ìœ¼ë¡œ iOS/Android ë™ì‹œ ê°œë°œ ì‹œ ë¹„ìš© 30~40% ì ˆê°.',
    commonRisk: 'ì•±ìŠ¤í† ì–´ ì‹¬ì‚¬(í‰ê·  1~2ì£¼)ë¥¼ ì¼ì •ì— ë°˜ë“œì‹œ í¬í•¨.',
    insightEmoji: 'ğŸ“±',
    marketInsight: '2025ë…„ ëª¨ë°”ì¼ ì•± ì‹œì¥ì€ ìŠˆí¼ì•± íŠ¸ë Œë“œì—ì„œ ë²„í‹°ì»¬ íŠ¹í™” ì•±ìœ¼ë¡œ ì „í™˜ ì¤‘ì…ë‹ˆë‹¤.',
    mvpScope: 'í•µì‹¬ ê¸°ëŠ¥ 3ê°œ + ì†Œì…œ ë¡œê·¸ì¸ + í‘¸ì‹œ ì•Œë¦¼',
    competitorExample: 'ë‹¹ê·¼ë§ˆì¼“, í† ìŠ¤, ì˜¤ëŠ˜ì˜ì§‘',
    topicPriority: ['overview', 'coreFeatures', 'targetUsers', 'techRequirements', 'budgetTimeline', 'referenceServices', 'additionalRequirements'],
    deepDiveQuestions: {
      overview: ['ì´ ì•±ì˜ í•µì‹¬ ê°€ì¹˜ë¥¼ í•œ ë¬¸ì¥ìœ¼ë¡œ í‘œí˜„í•˜ë©´?', 'ìœ ì‚¬í•œ ì•±ì´ ìˆë‹¤ë©´, ì–´ë–¤ ì ì´ ë‹¤ë¥¸ê°€ìš”?'],
      targetUsers: ['í•˜ë£¨ ì¤‘ ì–¸ì œ ì´ ì•±ì„ ê°€ì¥ ë§ì´ ì‚¬ìš©í•  ê²ƒ ê°™ìœ¼ì„¸ìš”?', 'ì•±ì„ ì²˜ìŒ ì‹¤í–‰í–ˆì„ ë•Œ ì‚¬ìš©ìê°€ ê°€ì¥ ë¨¼ì € í•´ì•¼ í•  í–‰ë™ì€?'],
      coreFeatures: ['ì´ ê¸°ëŠ¥ë“¤ ì¤‘ "ì´ê²ƒë§Œ ë˜ë©´ ì¶œì‹œí•  ìˆ˜ ìˆë‹¤"ëŠ” í•µì‹¬ 1ê°€ì§€ëŠ”?', 'ì‚¬ìš©ìê°€ ê°€ì¥ ìì£¼ ì“¸ ê¸°ëŠ¥ì€ ë¬´ì—‡ì¸ê°€ìš”?'],
      referenceServices: [], techRequirements: [], budgetTimeline: [], additionalRequirements: [],
    },
    quickRepliesMap: {
      overview: [], targetUsers: ['20~30ëŒ€ ì§ì¥ì¸', 'ì „ ì—°ë ¹ ì¼ë°˜ ì‚¬ìš©ì', '10~20ëŒ€ í•™ìƒ/MZì„¸ëŒ€', '40~60ëŒ€ ì‹œë‹ˆì–´'],
      coreFeatures: ['ì†Œì…œ ë¡œê·¸ì¸', 'ê²°ì œ ê¸°ëŠ¥', 'ì±„íŒ…/ë©”ì‹œì§€', 'ì§€ë„/ìœ„ì¹˜ ê¸°ë°˜', 'í‘¸ì‹œ ì•Œë¦¼', 'ì˜ˆì•½ ê¸°ëŠ¥'],
      referenceServices: ['ê±´ë„ˆë›°ê¸°', 'ì§ì ‘ ì…ë ¥í• ê²Œìš”'], techRequirements: ['ëª¨ë°”ì¼ ì•± (iOS/Android)', 'ì›¹ + ì•± ë‘˜ ë‹¤', 'ì•„ì§ ë¯¸ì •ì´ì—ìš”'],
      budgetTimeline: ['1,000~3,000ë§Œì›', '3,000~5,000ë§Œì›', '5,000ë§Œì› ì´ìƒ', 'ì•„ì§ ë¯¸ì •'], additionalRequirements: ['ì†ŒìŠ¤ì½”ë“œ ê·€ì† í•„ìš”', 'ë””ìì¸ í¬í•¨', 'ìœ ì§€ë³´ìˆ˜ ê³„ì•½ í•„ìš”', 'ê±´ë„ˆë›°ê¸°'],
    },
  },
  'ì›¹ ì„œë¹„ìŠ¤': {
    type: 'ì›¹ ì„œë¹„ìŠ¤',
    avgBudget: '1,500~4,000ë§Œì›',
    avgDuration: '4~6ì£¼(MVP)',
    successRate: '78%',
    keyFeatures: ['ë°˜ì‘í˜• ë””ìì¸', 'íšŒì› ì‹œìŠ¤í…œ', 'SEO ìµœì í™”'],
    mustHaveFeatures: ['ë°˜ì‘í˜•(ëª¨ë°”ì¼ ëŒ€ì‘)', 'SEO ë©”íƒ€ íƒœê·¸', 'SSL ì¸ì¦ì„œ'],
    commonMistakes: ['ëª¨ë°”ì¼ ì‚¬ìš©ì ë¹„ìœ¨ ê³¼ì†Œí‰ê°€', 'SEO ë¯¸ê³ ë ¤', 'ë¸Œë¼ìš°ì € í˜¸í™˜ì„± ë¯¸í…ŒìŠ¤íŠ¸'],
    techTip: 'Next.jsê°€ SEO, ì„±ëŠ¥, ê°œë°œ ìƒì‚°ì„± ì¸¡ë©´ì—ì„œ í˜„ì¬ ê°€ì¥ ê²€ì¦ëœ ì„ íƒ.',
    commonRisk: 'ë¸Œë¼ìš°ì € í˜¸í™˜ì„±(Chrome, Safari, Edge)ì„ ì´ˆê¸°ì— ì •ì˜í•´ì•¼ ìˆ˜ì • ë¹„ìš© ì ˆê°.',
    insightEmoji: 'ğŸŒ',
    marketInsight: 'ì›¹ ì„œë¹„ìŠ¤ëŠ” ì´ˆê¸° ì§„ì…ì¥ë²½ì´ ê°€ì¥ ë‚®ê³ , ì´í›„ ì•±ìœ¼ë¡œ í™•ì¥í•˜ê¸° ìš©ì´í•©ë‹ˆë‹¤.',
    mvpScope: 'í•µì‹¬ í˜ì´ì§€ 5ê°œ ì´ë‚´ + íšŒì› ì‹œìŠ¤í…œ + ë°˜ì‘í˜•',
    competitorExample: 'ë…¸ì…˜, ìŠ¬ë™, í”¼ê·¸ë§ˆ',
    topicPriority: ['overview', 'coreFeatures', 'targetUsers', 'budgetTimeline', 'referenceServices', 'techRequirements', 'additionalRequirements'],
    deepDiveQuestions: {
      overview: ['ì´ ì„œë¹„ìŠ¤ì˜ ìˆ˜ìµ ëª¨ë¸ì€ ë¬´ì—‡ì¸ê°€ìš”?', 'PCì™€ ëª¨ë°”ì¼ ì¤‘ ì–´ë””ì—ì„œ ë” ë§ì´ ì ‘ì†í•  ê²ƒ ê°™ìœ¼ì„¸ìš”?'],
      targetUsers: ['ì‚¬ìš©ìê°€ ì´ ì„œë¹„ìŠ¤ë¥¼ ì–¼ë§ˆë‚˜ ìì£¼ ë°©ë¬¸í•  ê²ƒ ê°™ë‚˜ìš”?'],
      coreFeatures: ['ê´€ë¦¬ìê°€ ì§ì ‘ ì½˜í…ì¸ ë¥¼ ìˆ˜ì •í•´ì•¼ í•˜ë‚˜ìš”?', 'ê²€ìƒ‰ ê¸°ëŠ¥ì´ ì¤‘ìš”í•œê°€ìš”?'],
      referenceServices: [], techRequirements: [], budgetTimeline: [], additionalRequirements: [],
    },
    quickRepliesMap: {
      overview: [], targetUsers: ['B2B ê¸°ì—… ê³ ê°', 'ì¼ë°˜ ì†Œë¹„ì(B2C)', 'ë‚´ë¶€ ì§ì›ìš©', 'íŠ¹ì • ì „ë¬¸ê°€ ê·¸ë£¹'],
      coreFeatures: ['íšŒì›ê°€ì…/ë¡œê·¸ì¸', 'ëŒ€ì‹œë³´ë“œ', 'ê²Œì‹œíŒ', 'ê²€ìƒ‰/í•„í„°', 'ê´€ë¦¬ì íŒ¨ë„', 'ê²°ì œ'],
      referenceServices: ['ê±´ë„ˆë›°ê¸°', 'ì§ì ‘ ì…ë ¥í• ê²Œìš”'], techRequirements: ['ì›¹ ì„œë¹„ìŠ¤', 'ì›¹ + ì•± ë‘˜ ë‹¤', 'ì•„ì§ ë¯¸ì •ì´ì—ìš”'],
      budgetTimeline: ['1,000~3,000ë§Œì›', '3,000~5,000ë§Œì›', '5,000ë§Œì› ì´ìƒ', 'ì•„ì§ ë¯¸ì •'], additionalRequirements: ['ì†ŒìŠ¤ì½”ë“œ ê·€ì† í•„ìš”', 'ë””ìì¸ í¬í•¨', 'ìœ ì§€ë³´ìˆ˜ ê³„ì•½ í•„ìš”', 'ê±´ë„ˆë›°ê¸°'],
    },
  },
  'ì›¹ì‚¬ì´íŠ¸': {
    type: 'ì›¹ì‚¬ì´íŠ¸',
    avgBudget: '500~2,000ë§Œì›',
    avgDuration: '2~4ì£¼',
    successRate: '85%',
    keyFeatures: ['ë°˜ì‘í˜• ë ˆì´ì•„ì›ƒ', 'ì½˜í…ì¸  ê´€ë¦¬', 'ë¬¸ì˜ í¼'],
    mustHaveFeatures: ['ëª¨ë°”ì¼ ë°˜ì‘í˜•', 'ë¬¸ì˜/ì—°ë½ì²˜ í¼', 'SEO ê¸°ë³¸ ì„¤ì •'],
    commonMistakes: ['ì½˜í…ì¸  ì¤€ë¹„ ì§€ì—°ìœ¼ë¡œ ì „ì²´ ë”œë ˆì´', 'CMS ì—†ì´ ì •ì ìœ¼ë¡œë§Œ ì œì‘', 'í˜¸ìŠ¤íŒ… ë¹„ìš© ë¯¸ê³ ë ¤'],
    techTip: 'WordPressë‚˜ Next.jsë¡œ ê°œë°œ ê¸°ê°„ 50% ì´ìƒ ë‹¨ì¶• ê°€ëŠ¥.',
    commonRisk: 'ì½˜í…ì¸ (í…ìŠ¤íŠ¸, ì´ë¯¸ì§€)ëŠ” ë°œì£¼ì‚¬ê°€ ë¯¸ë¦¬ ì¤€ë¹„í•´ì•¼ ì¼ì •ì´ ë§ìŠµë‹ˆë‹¤.',
    insightEmoji: 'ğŸ ',
    marketInsight: 'ì›¹ì‚¬ì´íŠ¸ëŠ” ì„±ê³µë¥ ì´ 85%ë¡œ ê°€ì¥ ë†’ìŠµë‹ˆë‹¤. ëª…í™•í•œ ëª©ì ë§Œ ìˆìœ¼ë©´ ì‹¤íŒ¨ê°€ ì ì–´ìš”.',
    mvpScope: 'ë©”ì¸ + ì†Œê°œ + ì„œë¹„ìŠ¤ + ë¬¸ì˜ í˜ì´ì§€',
    competitorExample: 'ì˜ ë§Œë“  ë¸Œëœë“œ ì‚¬ì´íŠ¸ í•˜ë‚˜ê°€ ì˜ì—…ì‚¬ì› 10ëª… ì—­í• ',
    // ì›¹ì‚¬ì´íŠ¸ëŠ” ê°„ì†Œí•œ í”Œë¡œìš° (5ê°œ ì§ˆë¬¸ì´ë©´ ì¶©ë¶„)
    topicPriority: ['overview', 'coreFeatures', 'budgetTimeline', 'referenceServices', 'additionalRequirements'],
    deepDiveQuestions: {
      overview: ['ì›¹ì‚¬ì´íŠ¸ì˜ ì£¼ìš” ëª©ì ì€ ë¬´ì—‡ì¸ê°€ìš”? (ë¸Œëœë”©/ë¦¬ë“œ ìˆ˜ì§‘/ì •ë³´ ì œê³µ)'],
      targetUsers: [], coreFeatures: ['ì½˜í…ì¸ ë¥¼ ì§ì ‘ ìˆ˜ì •í•  ìˆ˜ ìˆì–´ì•¼ í•˜ë‚˜ìš”? (CMS í•„ìš” ì—¬ë¶€)'],
      referenceServices: [], techRequirements: [], budgetTimeline: [], additionalRequirements: [],
    },
    quickRepliesMap: {
      overview: [], targetUsers: ['ì ì¬ ê³ ê°', 'ê¸°ì¡´ ê³ ê°', 'íˆ¬ìì/íŒŒíŠ¸ë„ˆ', 'ì¼ë°˜ ëŒ€ì¤‘'],
      coreFeatures: ['ì½˜í…ì¸  ê´€ë¦¬(CMS)', 'ë¬¸ì˜ í¼', 'ë¸”ë¡œê·¸', 'í¬íŠ¸í´ë¦¬ì˜¤', 'ë‰´ìŠ¤/ê³µì§€ì‚¬í•­', 'FAQ'],
      referenceServices: ['ê±´ë„ˆë›°ê¸°', 'ì§ì ‘ ì…ë ¥í• ê²Œìš”'], techRequirements: ['ì›¹ì‚¬ì´íŠ¸(ë°˜ì‘í˜•)', 'ì•„ì§ ë¯¸ì •ì´ì—ìš”'],
      budgetTimeline: ['500~1,000ë§Œì›', '1,000~2,000ë§Œì›', '2,000ë§Œì› ì´ìƒ', 'ì•„ì§ ë¯¸ì •'], additionalRequirements: ['ì†ŒìŠ¤ì½”ë“œ ê·€ì† í•„ìš”', 'ë””ìì¸ í¬í•¨', 'ìœ ì§€ë³´ìˆ˜ ê³„ì•½ í•„ìš”', 'ê±´ë„ˆë›°ê¸°'],
    },
  },
  'ì´ì»¤ë¨¸ìŠ¤': {
    type: 'ì´ì»¤ë¨¸ìŠ¤',
    avgBudget: '3,000~8,000ë§Œì›',
    avgDuration: '8~12ì£¼',
    successRate: '65%',
    keyFeatures: ['ìƒí’ˆ ê´€ë¦¬', 'ì¥ë°”êµ¬ë‹ˆ/ê²°ì œ', 'ì£¼ë¬¸/ë°°ì†¡ ê´€ë¦¬', 'ë¦¬ë·°'],
    mustHaveFeatures: ['PG ê²°ì œ(ì¹´ë“œ/ê°„í¸ê²°ì œ)', 'ì£¼ë¬¸ ìƒíƒœ ê´€ë¦¬', 'ì¬ê³  ê´€ë¦¬', 'êµí™˜/í™˜ë¶ˆ ì²˜ë¦¬'],
    commonMistakes: ['ì¬ê³  ê´€ë¦¬ ë³µì¡ë„ ê³¼ì†Œí‰ê°€', 'PG ì‹¬ì‚¬ ê¸°ê°„(2~3ì£¼) ë¯¸ë°˜ì˜', 'ì •ì‚° ì‹œìŠ¤í…œ í›„ìˆœìœ„ ì²˜ë¦¬'],
    techTip: 'PG ì—°ë™(í† ìŠ¤í˜ì´ë¨¼ì¸ )ì€ ì‹¬ì‚¬ì— 2~3ì£¼ ì†Œìš”. ì´ˆê¸° ì„¤ê³„ì— ë°˜ë“œì‹œ í¬í•¨.',
    commonRisk: 'êµí™˜/í™˜ë¶ˆ í”„ë¡œì„¸ìŠ¤ì™€ ì •ì‚° ì‹œìŠ¤í…œì´ ê°€ì¥ ë³µì¡í•œ ë¶€ë¶„.',
    insightEmoji: 'ğŸ›’',
    marketInsight: 'ì´ì»¤ë¨¸ìŠ¤ëŠ” PG+ì •ì‚°+êµí™˜í™˜ë¶ˆì´ ê°œë°œì˜ 60%ë¥¼ ì°¨ì§€í•©ë‹ˆë‹¤.',
    mvpScope: 'ìƒí’ˆ ë“±ë¡ + ì¥ë°”êµ¬ë‹ˆ + ê²°ì œ + ì£¼ë¬¸ ê´€ë¦¬',
    competitorExample: 'ë¬´ì‹ ì‚¬, ë§ˆì¼“ì»¬ë¦¬, í¬ë¦¼',
    topicPriority: ['overview', 'coreFeatures', 'targetUsers', 'budgetTimeline', 'techRequirements', 'referenceServices', 'additionalRequirements'],
    deepDiveQuestions: {
      overview: ['ì–´ë–¤ ìƒí’ˆ/ì„œë¹„ìŠ¤ë¥¼ íŒë§¤í•˜ì‹œë‚˜ìš”?', 'ê²°ì œ í›„ ë°°ì†¡ì´ í•„ìš”í•œ ì‹¤ë¬¼ ìƒí’ˆì¸ê°€ìš”, ë””ì§€í„¸ ìƒí’ˆì¸ê°€ìš”?'],
      targetUsers: ['êµ¬ë§¤ìê°€ ì£¼ë¡œ ì–´ë–¤ ê²½ë¡œë¡œ ìƒí’ˆì„ ì°¾ê²Œ ë ê¹Œìš”?'],
      coreFeatures: ['êµí™˜/í™˜ë¶ˆ í”„ë¡œì„¸ìŠ¤ê°€ í•„ìš”í•œê°€ìš”?', 'íŒë§¤ì ì •ì‚° ê¸°ëŠ¥ì´ í•„ìš”í•œê°€ìš”?'],
      referenceServices: [], techRequirements: [], budgetTimeline: [], additionalRequirements: [],
    },
    quickRepliesMap: {
      overview: [], targetUsers: ['20~40ëŒ€ ì˜¨ë¼ì¸ ì‡¼í•‘ ì´ìš©ì', 'B2B ë„ë§¤/ê¸°ì—… êµ¬ë§¤ì', 'íŠ¹ì • ì·¨ë¯¸/ê´€ì‹¬ì‚¬ ì»¤ë®¤ë‹ˆí‹°', 'ì „ ì—°ë ¹ ì¼ë°˜ ì†Œë¹„ì'],
      coreFeatures: ['ì¥ë°”êµ¬ë‹ˆ/ê²°ì œ', 'ìƒí’ˆ ê´€ë¦¬', 'ì£¼ë¬¸/ë°°ì†¡ ì¶”ì ', 'ë¦¬ë·°/í‰ì ', 'ì¿ í°/í¬ì¸íŠ¸', 'ê²€ìƒ‰/í•„í„°'],
      referenceServices: ['ê±´ë„ˆë›°ê¸°', 'ì§ì ‘ ì…ë ¥í• ê²Œìš”'], techRequirements: ['ì›¹ ì„œë¹„ìŠ¤', 'ëª¨ë°”ì¼ ì•±', 'ì›¹ + ì•± ë‘˜ ë‹¤', 'ì•„ì§ ë¯¸ì •ì´ì—ìš”'],
      budgetTimeline: ['3,000~5,000ë§Œì›', '5,000~8,000ë§Œì›', '1ì–µ ì´ìƒ', 'ì•„ì§ ë¯¸ì •'], additionalRequirements: ['ì†ŒìŠ¤ì½”ë“œ ê·€ì† í•„ìš”', 'ë””ìì¸ í¬í•¨', 'ìœ ì§€ë³´ìˆ˜ ê³„ì•½ í•„ìš”', 'ê±´ë„ˆë›°ê¸°'],
    },
  },
  'í”Œë«í¼': {
    type: 'í”Œë«í¼',
    avgBudget: '5,000ë§Œ~1.5ì–µ',
    avgDuration: '8~16ì£¼',
    successRate: '58%',
    keyFeatures: ['ê³µê¸‰/ìˆ˜ìš” ë§¤ì¹­', 'ê²°ì œ/ì •ì‚°', 'ë¦¬ë·°/í‰ê°€', 'ê´€ë¦¬ì ëŒ€ì‹œë³´ë“œ'],
    mustHaveFeatures: ['ì–‘ë©´ ì‚¬ìš©ì ê°€ì…', 'ë§¤ì¹­/ê²€ìƒ‰', 'ê²°ì œ/ì •ì‚° ë¶„ë¦¬', 'ë¶„ìŸ í•´ê²°'],
    commonMistakes: ['"ë‹­ê³¼ ë‹¬ê±€" ë¬¸ì œ í•´ê²° ì „ëµ ë¶€ì¬', 'ì •ì‚° ì‹œìŠ¤í…œ í›„ìˆœìœ„', 'ê³µê¸‰ì/ìˆ˜ìš”ì UX ë¯¸ë¶„ë¦¬'],
    techTip: 'ì–‘ë©´ ë§ˆì¼“í”Œë ˆì´ìŠ¤ëŠ” ì´ˆê¸°ì— í•œìª½ì— ì§‘ì¤‘í•˜ëŠ” ê²ƒì´ ì„±ê³µë¥ ì´ ë†’ìŠµë‹ˆë‹¤.',
    commonRisk: 'ì–‘ë©´ ì‹œì¥ì˜ "ë‹­ê³¼ ë‹¬ê±€" ë¬¸ì œ í•´ê²° ì „ëµì´ í•„ìˆ˜.',
    insightEmoji: 'ğŸ”—',
    marketInsight: 'í”Œë«í¼ ì„±ê³µì˜ í•µì‹¬ì€ ê¸°ìˆ ì´ ì•„ë‹ˆë¼ ì´ˆê¸° ì‚¬ìš©ì í™•ë³´ ì „ëµì…ë‹ˆë‹¤.',
    mvpScope: 'í•œìª½ ì‚¬ìš©ì + ë§¤ì¹­ + ì±„íŒ… (ê²°ì œëŠ” 2ì°¨)',
    competitorExample: 'ìœ„ì‹œì¼“, í¬ëª½, ìˆ¨ê³ ',
    topicPriority: ['overview', 'targetUsers', 'coreFeatures', 'budgetTimeline', 'techRequirements', 'referenceServices', 'additionalRequirements'],
    deepDiveQuestions: {
      overview: ['ê³µê¸‰ìì™€ ìˆ˜ìš”ì ê°ê° ì–´ë–¤ ë¶„ë“¤ì¸ê°€ìš”?', 'ì´ˆê¸°ì— ì–´ëŠ ìª½ì„ ë¨¼ì € ëª¨ì„ ê³„íšì¸ê°€ìš”?'],
      targetUsers: ['ê³µê¸‰ìì™€ ìˆ˜ìš”ì ì¤‘ ì–´ëŠ ìª½ì˜ ê°€ì… ì ˆì°¨ê°€ ë” ë³µì¡í•œê°€ìš”?'],
      coreFeatures: ['ë§¤ì¹­ ë°©ì‹ì€ ì–´ë–¤ ê±¸ ì›í•˜ì‹œë‚˜ìš”? (ê²€ìƒ‰ ê¸°ë°˜ / ì¶”ì²œ ê¸°ë°˜ / ì…ì°° ê¸°ë°˜)'],
      referenceServices: [], techRequirements: [], budgetTimeline: [], additionalRequirements: [],
    },
    quickRepliesMap: {
      overview: [], targetUsers: ['ì „ë¬¸ê°€ â†” ì¼ë°˜ ì†Œë¹„ì', 'ê¸°ì—… â†” í”„ë¦¬ëœì„œ', 'íŒë§¤ì â†” êµ¬ë§¤ì', 'ì„œë¹„ìŠ¤ ì œê³µì â†” ì´ìš©ì'],
      coreFeatures: ['ë§¤ì¹­/ê²€ìƒ‰', 'ì±„íŒ…/ë©”ì‹œì§€', 'ê²°ì œ/ì •ì‚°', 'ë¦¬ë·°/í‰ê°€', 'í”„ë¡œí•„/í¬íŠ¸í´ë¦¬ì˜¤', 'ê´€ë¦¬ì ëŒ€ì‹œë³´ë“œ'],
      referenceServices: ['ê±´ë„ˆë›°ê¸°', 'ì§ì ‘ ì…ë ¥í• ê²Œìš”'], techRequirements: ['ì›¹ ì„œë¹„ìŠ¤', 'ëª¨ë°”ì¼ ì•±', 'ì›¹ + ì•± ë‘˜ ë‹¤', 'ì•„ì§ ë¯¸ì •ì´ì—ìš”'],
      budgetTimeline: ['3,000~5,000ë§Œì›', '5,000ë§Œ~1ì–µ', '1ì–µ ì´ìƒ', 'ì•„ì§ ë¯¸ì •'], additionalRequirements: ['ì†ŒìŠ¤ì½”ë“œ ê·€ì† í•„ìš”', 'ë””ìì¸ í¬í•¨', 'ìœ ì§€ë³´ìˆ˜ ê³„ì•½ í•„ìš”', 'ê±´ë„ˆë›°ê¸°'],
    },
  },
  'SaaS': {
    type: 'SaaS',
    avgBudget: '3,000~8,000ë§Œì›',
    avgDuration: '8~12ì£¼',
    successRate: '62%',
    keyFeatures: ['ë©€í‹°í…Œë„Œì‹œ', 'êµ¬ë…/ê²°ì œ', 'ëŒ€ì‹œë³´ë“œ', 'íŒ€ ê´€ë¦¬'],
    mustHaveFeatures: ['êµ¬ë… ê²°ì œ(ì›”/ì—°)', 'íŒ€/ì›Œí¬ìŠ¤í˜ì´ìŠ¤', 'ë°ì´í„° ë‚´ë³´ë‚´ê¸°', 'ì‚¬ìš©ëŸ‰ ëŒ€ì‹œë³´ë“œ'],
    commonMistakes: ['ìš”ê¸ˆ ì²´ê³„ë¥¼ ë„ˆë¬´ ë³µì¡í•˜ê²Œ ì„¤ê³„', 'ì˜¨ë³´ë”© ë¯¸ì„¤ê³„', 'ë©€í‹°í…Œë„Œì‹œ ë³´ì•ˆ ë¯¸ê³ ë ¤'],
    techTip: 'ì´ˆê¸°ì—ëŠ” ë‹¨ì¼ ìš”ê¸ˆì œ â†’ PMF ê²€ì¦ í›„ ì„¸ë¶„í™”. Stripe/í† ìŠ¤í˜ì´ë¨¼ì¸  ì¶”ì²œ.',
    commonRisk: 'SaaSëŠ” ì§€ì† ìš´ì˜ì´ í•µì‹¬. ìœ ì§€ë³´ìˆ˜ ê³„ì•½ì„ ì‚¬ì „ì— ë°˜ë“œì‹œ í˜‘ì˜.',
    insightEmoji: 'â˜ï¸',
    marketInsight: 'SaaSëŠ” MRR(ì›”ê°„ ë°˜ë³µ ë§¤ì¶œ) êµ¬ì¡°ê°€ í•µì‹¬. ì²« 100ëª… ìœ ë£Œ ê³ ê°ì´ PMF ì§€í‘œ.',
    mvpScope: 'í•µì‹¬ ê¸°ëŠ¥ 1ê°œ + êµ¬ë… ê²°ì œ + ì˜¨ë³´ë”©',
    competitorExample: 'ì±„ë„í†¡, í† ìŠ¤í˜ì´ë¨¼ì¸ , ë¦¬ë©¤ë²„',
    topicPriority: ['overview', 'targetUsers', 'coreFeatures', 'budgetTimeline', 'techRequirements', 'referenceServices', 'additionalRequirements'],
    deepDiveQuestions: {
      overview: ['ì‚¬ìš©í•  ê¸°ì—…/íŒ€ì˜ ê·œëª¨ëŠ” ì–´ëŠ ì •ë„ì¸ê°€ìš”?', 'êµ¬ë§¤ ì˜ì‚¬ê²°ì •ìì™€ ì‹¤ì‚¬ìš©ìê°€ ë‹¤ë¥¸ê°€ìš”?'],
      targetUsers: ['ìœ ë£Œ ì „í™˜ í•µì‹¬ íŠ¸ë¦¬ê±°ê°€ ë¬´ì—‡ì´ë¼ ìƒê°í•˜ì„¸ìš”?'],
      coreFeatures: ['íŒ€ í˜‘ì—… ê¸°ëŠ¥ì´ í•„ìš”í•œê°€ìš”?', 'ì™¸ë¶€ ì„œë¹„ìŠ¤ ì—°ë™(API)ì´ í•„ìš”í•œê°€ìš”?'],
      referenceServices: [], techRequirements: [], budgetTimeline: [], additionalRequirements: [],
    },
    quickRepliesMap: {
      overview: [], targetUsers: ['ìŠ¤íƒ€íŠ¸ì—…/ì†Œê·œëª¨ íŒ€', 'ì¤‘ê²¬ê¸°ì—…', 'ëŒ€ê¸°ì—…', '1ì¸ ê¸°ì—…/í”„ë¦¬ëœì„œ'],
      coreFeatures: ['ëŒ€ì‹œë³´ë“œ/ë¶„ì„', 'íŒ€ ê´€ë¦¬/ê¶Œí•œ', 'êµ¬ë… ê²°ì œ', 'API ì—°ë™', 'ë°ì´í„° ë‚´ë³´ë‚´ê¸°', 'ì•Œë¦¼/ë¦¬í¬íŠ¸'],
      referenceServices: ['ê±´ë„ˆë›°ê¸°', 'ì§ì ‘ ì…ë ¥í• ê²Œìš”'], techRequirements: ['ì›¹ ì„œë¹„ìŠ¤', 'ì›¹ + ì•± ë‘˜ ë‹¤', 'ì•„ì§ ë¯¸ì •ì´ì—ìš”'],
      budgetTimeline: ['3,000~5,000ë§Œì›', '5,000~8,000ë§Œì›', '1ì–µ ì´ìƒ', 'ì•„ì§ ë¯¸ì •'], additionalRequirements: ['ì†ŒìŠ¤ì½”ë“œ ê·€ì† í•„ìš”', 'ë””ìì¸ í¬í•¨', 'ìœ ì§€ë³´ìˆ˜ ê³„ì•½ í•„ìš”', 'ê±´ë„ˆë›°ê¸°'],
    },
  },
  'AI ì„œë¹„ìŠ¤': {
    type: 'AI ê¸°ë°˜ ì„œë¹„ìŠ¤',
    avgBudget: '3,000~1ì–µ',
    avgDuration: '8~16ì£¼',
    successRate: '60%',
    keyFeatures: ['AI ëª¨ë¸ ì—°ë™', 'ë°ì´í„° ì²˜ë¦¬', 'ê²°ê³¼ ì‹œê°í™”'],
    mustHaveFeatures: ['AI API ì—°ë™', 'í”„ë¡¬í”„íŠ¸ ê´€ë¦¬', 'ê²°ê³¼ ìºì‹±', 'ì‚¬ìš©ëŸ‰ ëª¨ë‹ˆí„°ë§'],
    commonMistakes: ['AI ì •í™•ë„ ê¸°ëŒ€ì¹˜ ë¯¸ì„¤ì •', 'API ë¹„ìš© ê³¼ì†Œí‰ê°€', 'ì‘ë‹µ ì†ë„ ë¯¸ê³ ë ¤'],
    techTip: 'AI ëª¨ë¸ ì§ì ‘ ê°œë°œë³´ë‹¤ API(OpenAI, Claude) í™œìš©ì´ ì´ˆê¸° ë¹„ìš© 80%+ ì ˆê°.',
    commonRisk: 'AI API ë¹„ìš©ì´ ì‚¬ìš©ëŸ‰ ë¹„ë¡€í•˜ë¯€ë¡œ ë¹„ìš© ê´€ë¦¬ ì „ëµ í•„ìˆ˜.',
    insightEmoji: 'ğŸ¤–',
    marketInsight: '2025ë…„ AI ì„œë¹„ìŠ¤ í•µì‹¬ì€ "AI ë˜í¼" â€” ê¸°ì¡´ API ìœ„ì— UXë¥¼ ì…íˆëŠ” ê²ƒ.',
    mvpScope: 'AI í•µì‹¬ ê¸°ëŠ¥ 1ê°œ + ê²°ê³¼ í™”ë©´ + ì‚¬ìš©ëŸ‰ ì œí•œ',
    competitorExample: 'ë¤¼íŠ¼, ìŠ¤ì¼ˆí„°ë©ìŠ¤, ì—…ìŠ¤í…Œì´ì§€',
    topicPriority: ['overview', 'coreFeatures', 'targetUsers', 'techRequirements', 'budgetTimeline', 'referenceServices', 'additionalRequirements'],
    deepDiveQuestions: {
      overview: ['AIê°€ í•´ê²°í•´ì•¼ í•  í•µì‹¬ ë¬¸ì œëŠ” ë¬´ì—‡ì¸ê°€ìš”?', 'ê¸°ì¡´ì— ì´ ë¬¸ì œë¥¼ ì–´ë–»ê²Œ í•´ê²°í•˜ê³  ìˆì—ˆë‚˜ìš”?'],
      targetUsers: ['ì‚¬ìš©ìê°€ AI ê²°ê³¼ë¬¼ì„ ì–¼ë§ˆë‚˜ ì‹ ë¢°í•´ì•¼ í•˜ë‚˜ìš”? (ì°¸ê³ ìš© vs ì˜ì‚¬ê²°ì •ìš©)'],
      coreFeatures: ['AI ì •í™•ë„ ëª©í‘œì¹˜ê°€ ìˆë‚˜ìš”?', 'AI ì‘ë‹µ ì‹œê°„ ìš”êµ¬ì‚¬í•­ì€?'],
      referenceServices: [], techRequirements: [], budgetTimeline: [], additionalRequirements: [],
    },
    quickRepliesMap: {
      overview: [], targetUsers: ['ì¼ë°˜ ì†Œë¹„ì', 'ì „ë¬¸ê°€/ì „ë¬¸ì§', 'ê¸°ì—… ì§ì›', 'ì½˜í…ì¸  í¬ë¦¬ì—ì´í„°'],
      coreFeatures: ['AI ì±—ë´‡/ëŒ€í™”', 'ì´ë¯¸ì§€ ìƒì„±/ë¶„ì„', 'ë¬¸ì„œ ìë™ ìƒì„±', 'ë°ì´í„° ë¶„ì„', 'ì¶”ì²œ ì‹œìŠ¤í…œ', 'ìŒì„± ì¸ì‹'],
      referenceServices: ['ê±´ë„ˆë›°ê¸°', 'ì§ì ‘ ì…ë ¥í• ê²Œìš”'], techRequirements: ['ì›¹ ì„œë¹„ìŠ¤', 'ëª¨ë°”ì¼ ì•±', 'ì›¹ + ì•± ë‘˜ ë‹¤', 'ì•„ì§ ë¯¸ì •ì´ì—ìš”'],
      budgetTimeline: ['3,000~5,000ë§Œì›', '5,000ë§Œ~1ì–µ', '1ì–µ ì´ìƒ', 'ì•„ì§ ë¯¸ì •'], additionalRequirements: ['ì†ŒìŠ¤ì½”ë“œ ê·€ì† í•„ìš”', 'ë””ìì¸ í¬í•¨', 'ìœ ì§€ë³´ìˆ˜ ê³„ì•½ í•„ìš”', 'ê±´ë„ˆë›°ê¸°'],
    },
  },
};

// ê°„ì†Œí•œ í”„ë¡œì íŠ¸ ìœ í˜• (ìƒì„¸ ë°ì´í„° ì—†ëŠ” ìœ í˜•ìš© ê¸°ë³¸ê°’)
const DEFAULT_PROJECT_TYPE: ProjectTypeInfo = {
  type: 'ì†Œí”„íŠ¸ì›¨ì–´ ì„œë¹„ìŠ¤',
  avgBudget: '2,000~5,000ë§Œì›',
  avgDuration: '6~12ì£¼',
  successRate: '70%',
  keyFeatures: ['í•µì‹¬ ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§', 'ì‚¬ìš©ì ì¸ì¦', 'ë°ì´í„° ê´€ë¦¬'],
  mustHaveFeatures: ['ì‚¬ìš©ì ì¸ì¦', 'í•µì‹¬ ê¸°ëŠ¥', 'ë°ì´í„° ë°±ì—…'],
  commonMistakes: ['ìš”êµ¬ì‚¬í•­ ë³€ê²½ì´ ê°€ì¥ í”í•œ ì§€ì—° ì›ì¸', 'MVP ë²”ìœ„ ê³¼ë‹¤ ì„¤ì •', 'í…ŒìŠ¤íŠ¸ ê¸°ê°„ ë¶€ì¡±'],
  techTip: 'ì²« MVPëŠ” í•µì‹¬ ê¸°ëŠ¥ 3ê°œ ì´ë‚´ë¡œ ì œí•œí•˜ëŠ” ê²ƒì´ ì„±ê³µ í™•ë¥ ì´ ê°€ì¥ ë†’ìŠµë‹ˆë‹¤.',
  commonRisk: 'ìŠ¤ì½”í”„ í¬ë¦¬í”„(ìš”êµ¬ì‚¬í•­ ê³„ì† ì¶”ê°€)ê°€ ê°€ì¥ í”í•œ í”„ë¡œì íŠ¸ ì‹¤íŒ¨ ì›ì¸.',
  insightEmoji: 'âš™ï¸',
  marketInsight: 'ì†Œí”„íŠ¸ì›¨ì–´ ì„œë¹„ìŠ¤ ì„±ê³µì˜ 80%ëŠ” ëª…í™•í•œ ë²”ìœ„ ì •ì˜ì—ì„œ ê²°ì •ë©ë‹ˆë‹¤.',
  mvpScope: 'í•µì‹¬ ê¸°ëŠ¥ 3ê°œ ì´ë‚´ + ì¸ì¦ + ê¸°ë³¸ ê´€ë¦¬',
  competitorExample: 'ëª…í™•í•œ ë¬¸ì œ í•´ê²°ì— ì§‘ì¤‘í•œ ì„œë¹„ìŠ¤ê°€ ì„±ê³µë¥ ì´ ë†’ìŠµë‹ˆë‹¤',
  topicPriority: ['overview', 'coreFeatures', 'targetUsers', 'budgetTimeline', 'techRequirements', 'referenceServices', 'additionalRequirements'],
  deepDiveQuestions: {
    overview: [], targetUsers: [], coreFeatures: [], referenceServices: [], techRequirements: [], budgetTimeline: [], additionalRequirements: [],
  },
  quickRepliesMap: {
    overview: [], targetUsers: ['ì¼ë°˜ ì†Œë¹„ì', 'ê¸°ì—… ê³ ê°(B2B)', 'ë‚´ë¶€ ì§ì›ìš©', 'íŠ¹ì • ì „ë¬¸ê°€ ê·¸ë£¹'],
    coreFeatures: ['íšŒì›ê°€ì…/ë¡œê·¸ì¸', 'ëŒ€ì‹œë³´ë“œ', 'ê²€ìƒ‰/í•„í„°', 'ê²°ì œ', 'ì•Œë¦¼', 'ê´€ë¦¬ì íŒ¨ë„'],
    referenceServices: ['ê±´ë„ˆë›°ê¸°', 'ì§ì ‘ ì…ë ¥í• ê²Œìš”'], techRequirements: ['ì›¹ ì„œë¹„ìŠ¤', 'ëª¨ë°”ì¼ ì•±', 'ì›¹ + ì•± ë‘˜ ë‹¤', 'ì•„ì§ ë¯¸ì •ì´ì—ìš”'],
    budgetTimeline: ['1,000~3,000ë§Œì›', '3,000~5,000ë§Œì›', '5,000ë§Œì› ì´ìƒ', 'ì•„ì§ ë¯¸ì •'], additionalRequirements: ['ì†ŒìŠ¤ì½”ë“œ ê·€ì† í•„ìš”', 'ë””ìì¸ í¬í•¨', 'ìœ ì§€ë³´ìˆ˜ ê³„ì•½ í•„ìš”', 'ê±´ë„ˆë›°ê¸°'],
  },
};

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  ê¸°ëŠ¥ ë¶„ì„ DB
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
const FEATURE_DB: Record<string, { desc: string; complexity: string; weeks: string; subFeatures: string[]; risks: string; acceptance: string }> = {
  'ë¡œê·¸ì¸': { desc: 'ì´ë©”ì¼/ì†Œì…œ(ì¹´ì¹´ì˜¤Â·ë„¤ì´ë²„Â·êµ¬ê¸€) ë¡œê·¸ì¸, ìë™ ë¡œê·¸ì¸, ë¹„ë°€ë²ˆí˜¸ ì°¾ê¸°', complexity: 'â˜…â˜…â˜†â˜†â˜†', weeks: '1~2ì£¼', subFeatures: ['ì´ë©”ì¼ íšŒì›ê°€ì…', 'ì†Œì…œ ë¡œê·¸ì¸', 'ë¹„ë°€ë²ˆí˜¸ ì°¾ê¸°/ì¬ì„¤ì •', 'ìë™ ë¡œê·¸ì¸(í† í°)', 'ë¡œê·¸ì¸ ì‹¤íŒ¨ ì²˜ë¦¬(5íšŒ ì ê¸ˆ)'], risks: 'ì†Œì…œ ë¡œê·¸ì¸ API ì •ì±… ë³€ê²½ ì‹œ ëŒ€ì‘ í•„ìš”', acceptance: 'íšŒì›ê°€ì…â†’ë¡œê·¸ì¸â†’í† í°ë°œê¸‰â†’ìë™ë¡œê·¸ì¸ ì „ì²´ í”Œë¡œìš° ì •ìƒ' },
  'íšŒì›': { desc: 'íšŒì›ê°€ì…(ì•½ê´€ ë™ì˜, í”„ë¡œí•„), íšŒì› ë“±ê¸‰, ë§ˆì´í˜ì´ì§€', complexity: 'â˜…â˜…â˜†â˜†â˜†', weeks: '1~1.5ì£¼', subFeatures: ['ì•½ê´€ ë™ì˜', 'í”„ë¡œí•„ ì„¤ì •/ìˆ˜ì •', 'íšŒì› íƒˆí‡´', 'íšŒì› ë“±ê¸‰'], risks: 'ê°œì¸ì •ë³´ ìˆ˜ì§‘ ë™ì˜ ë²•ì  ê²€í†  í•„ìš”', acceptance: 'ê°€ì…â†’í”„ë¡œí•„ì„¤ì •â†’ìˆ˜ì •â†’íƒˆí‡´ ë¼ì´í”„ì‚¬ì´í´ ì •ìƒ' },
  'ê²°ì œ': { desc: 'PG ì—°ë™(í† ìŠ¤í˜ì´ë¨¼ì¸ /ì´ë‹ˆì‹œìŠ¤), ì¹´ë“œÂ·ê³„ì¢Œì´ì²´Â·ê°„í¸ê²°ì œ', complexity: 'â˜…â˜…â˜…â˜…â˜†', weeks: '2~3ì£¼', subFeatures: ['PG ì—°ë™', 'ì‹ ìš©ì¹´ë“œ/ê³„ì¢Œì´ì²´', 'ê°„í¸ê²°ì œ(ì¹´ì¹´ì˜¤í˜ì´Â·ë„¤ì´ë²„í˜ì´)', 'ê²°ì œ ë‚´ì—­', 'í™˜ë¶ˆ ì²˜ë¦¬'], risks: 'PG ì‹¬ì‚¬ì— 2~3ì£¼ ì†Œìš”', acceptance: 'ê²°ì œ ìš”ì²­â†’ìŠ¹ì¸â†’ì™„ë£Œâ†’ë‚´ì—­ì¡°íšŒâ†’í™˜ë¶ˆ ì „ì²´ í”Œë¡œìš° ì •ìƒ' },
  'ì±„íŒ…': { desc: 'WebSocket ê¸°ë°˜ ì‹¤ì‹œê°„ 1:1/ê·¸ë£¹ ë©”ì‹œì§•, ì½ìŒ í™•ì¸', complexity: 'â˜…â˜…â˜…â˜…â˜†', weeks: '2~4ì£¼', subFeatures: ['1:1 ì±„íŒ…', 'ê·¸ë£¹ ì±„íŒ…', 'ì½ìŒ í™•ì¸', 'íŒŒì¼/ì´ë¯¸ì§€ ì²¨ë¶€', 'ì±„íŒ… ì•Œë¦¼'], risks: 'WebSocket ì„œë²„ ë³„ë„ í•„ìš”, ë™ì‹œì ‘ì†ì ìˆ˜ ë”°ë¥¸ ì¸í”„ë¼ ë¹„ìš©', acceptance: 'ë©”ì‹œì§€ ì „ì†¡â†’ìˆ˜ì‹ â†’ì½ìŒí™•ì¸â†’íŒŒì¼ì²¨ë¶€â†’ì•Œë¦¼ 1ì´ˆ ì´ë‚´' },
  'ê´€ë¦¬ì': { desc: 'ì‚¬ìš©ì/ì½˜í…ì¸  ê´€ë¦¬, í†µê³„ ëŒ€ì‹œë³´ë“œ, ê³µì§€ì‚¬í•­', complexity: 'â˜…â˜…â˜…â˜…â˜†', weeks: '2~4ì£¼', subFeatures: ['ì‚¬ìš©ì ê´€ë¦¬', 'ì½˜í…ì¸  ê´€ë¦¬', 'í†µê³„ ëŒ€ì‹œë³´ë“œ', 'ê³µì§€ì‚¬í•­', 'ì‹ ê³  ì²˜ë¦¬'], risks: 'ê´€ë¦¬ì ê¶Œí•œ ë¶„ë¦¬ ì„¤ê³„ í•„ìš”', acceptance: 'ì‚¬ìš©ìê²€ìƒ‰â†’ìƒíƒœë³€ê²½â†’í†µê³„í™•ì¸â†’ê³µì§€ë“±ë¡ ì „ì²´ ì •ìƒ' },
  'ì•Œë¦¼': { desc: 'í‘¸ì‹œ(FCM/APNs), ì¸ì•± ì•Œë¦¼, ì´ë©”ì¼/SMS', complexity: 'â˜…â˜…â˜†â˜†â˜†', weeks: '1~2ì£¼', subFeatures: ['í‘¸ì‹œ ì•Œë¦¼(FCM/APNs)', 'ì¸ì•± ì•Œë¦¼ ì„¼í„°', 'ì´ë©”ì¼ ì•Œë¦¼', 'SMS ì•Œë¦¼', 'ì•Œë¦¼ ì„¤ì •'], risks: 'í‘¸ì‹œ í† í° ê´€ë¦¬ì™€ ì•Œë¦¼ ì‹¤íŒ¨ ëŒ€ì‘ í•„ìš”', acceptance: 'ì´ë²¤íŠ¸â†’ì•Œë¦¼ì „ì†¡â†’ìˆ˜ì‹ â†’ì½ìŒì²˜ë¦¬â†’ì„¤ì •ë³€ê²½ ì •ìƒ' },
  'ê²€ìƒ‰': { desc: 'í‚¤ì›Œë“œÂ·ìë™ì™„ì„±Â·ë‹¤ì¤‘ í•„í„°, ìµœê·¼/ì¸ê¸° ê²€ìƒ‰ì–´', complexity: 'â˜…â˜…â˜…â˜†â˜†', weeks: '1~2ì£¼', subFeatures: ['í‚¤ì›Œë“œ ê²€ìƒ‰', 'ìë™ì™„ì„±', 'ë‹¤ì¤‘ ì¡°ê±´ í•„í„°', 'ìµœê·¼ ê²€ìƒ‰ì–´', 'ì¸ê¸° ê²€ìƒ‰ì–´'], risks: 'ë°ì´í„°ëŸ‰ ì¦ê°€ ì‹œ Elasticsearch ê²€í† ', acceptance: 'ê²€ìƒ‰â†’í•„í„°â†’ì •ë ¬â†’ìë™ì™„ì„± 0.5ì´ˆ ì´ë‚´ ì‘ë‹µ' },
  'ì§€ë„': { desc: 'GPS í˜„ì¬ ìœ„ì¹˜, ì¥ì†Œ ê²€ìƒ‰(ì¹´ì¹´ì˜¤ë§µ/êµ¬ê¸€ë§µ), ë§ˆì»¤Â·ê²½ë¡œ', complexity: 'â˜…â˜…â˜…â˜†â˜†', weeks: '1~2ì£¼', subFeatures: ['í˜„ì¬ ìœ„ì¹˜ íƒì§€', 'ì¥ì†Œ ê²€ìƒ‰', 'ë§ˆì»¤ í‘œì‹œ', 'ê²½ë¡œ ì•ˆë‚´', 'ì£¼ë³€ ê²€ìƒ‰'], risks: 'ì§€ë„ API ì‚¬ìš©ëŸ‰ ê¸°ë°˜ ê³¼ê¸ˆ ì£¼ì˜', acceptance: 'ìœ„ì¹˜íƒì§€â†’ê²€ìƒ‰â†’ë§ˆì»¤í‘œì‹œâ†’ê²½ë¡œì•ˆë‚´ ì •ìƒ' },
  'ì˜ˆì•½': { desc: 'ìº˜ë¦°ë” UI, ì‹¤ì‹œê°„ ê°€ìš©ì„±, ì˜ˆì•½/ì·¨ì†Œ/ë³€ê²½, ë¦¬ë§ˆì¸ë”', complexity: 'â˜…â˜…â˜…â˜…â˜†', weeks: '2~3ì£¼', subFeatures: ['ìº˜ë¦°ë” UI', 'ì‹œê°„ ìŠ¬ë¡¯ ì„ íƒ', 'ì‹¤ì‹œê°„ ê°€ìš©ì„±', 'ì˜ˆì•½ í™•ì¸/ì·¨ì†Œ', 'ë¦¬ë§ˆì¸ë”'], risks: 'ë™ì‹œ ì˜ˆì•½ ë°©ì§€ í•„ìˆ˜', acceptance: 'ë‚ ì§œì„ íƒâ†’ì‹œê°„â†’ì˜ˆì•½â†’í™•ì¸â†’ì·¨ì†Œ ì „ì²´ ì •ìƒ' },
  'ë¦¬ë·°': { desc: 'ë³„ì (1~5), í…ìŠ¤íŠ¸/ì‚¬ì§„ ë¦¬ë·°, í‰ê·  ë³„ì ', complexity: 'â˜…â˜…â˜†â˜†â˜†', weeks: '1ì£¼', subFeatures: ['ë³„ì  í‰ê°€', 'í…ìŠ¤íŠ¸ ë¦¬ë·°', 'ì‚¬ì§„ ì²¨ë¶€', 'ë¦¬ë·° ì‹ ê³ ', 'ì •ë ¬/í•„í„°'], risks: 'í—ˆìœ„ ë¦¬ë·° ë°©ì§€(êµ¬ë§¤ ì¸ì¦) í•„ìš”', acceptance: 'ë¦¬ë·°ì‘ì„±â†’ë³„ì â†’ì‚¬ì§„â†’ëª©ë¡â†’ì •ë ¬ ì •ìƒ' },
  'ê²Œì‹œíŒ': { desc: 'WYSIWYG ì—ë””í„°, ëŒ“ê¸€/ëŒ€ëŒ“ê¸€, ì¢‹ì•„ìš”, ì‹ ê³ ', complexity: 'â˜…â˜…â˜…â˜†â˜†', weeks: '1~2ì£¼', subFeatures: ['ê¸€ ì‘ì„±/ìˆ˜ì •/ì‚­ì œ', 'WYSIWYG ì—ë””í„°', 'ì´ë¯¸ì§€/íŒŒì¼ ì²¨ë¶€', 'ëŒ“ê¸€/ëŒ€ëŒ“ê¸€', 'ì¢‹ì•„ìš”'], risks: 'ì—ë””í„° ì„ íƒì— ë”°ë¼ êµ¬í˜„ ë²”ìœ„ ì°¨ì´', acceptance: 'ê¸€ì‘ì„±â†’ì´ë¯¸ì§€â†’ëŒ“ê¸€â†’ì¢‹ì•„ìš”â†’ì‹ ê³  ì „ì²´ ì •ìƒ' },
  'ì¥ë°”êµ¬ë‹ˆ': { desc: 'ìƒí’ˆ ë‹´ê¸°/ì‚­ì œ, ìˆ˜ëŸ‰Â·ì˜µì…˜ ë³€ê²½, í•©ê³„ ê³„ì‚°', complexity: 'â˜…â˜…â˜†â˜†â˜†', weeks: '1~1.5ì£¼', subFeatures: ['ìƒí’ˆ ë‹´ê¸°/ì‚­ì œ', 'ìˆ˜ëŸ‰ ë³€ê²½', 'ì˜µì…˜ ì„ íƒ', 'í•©ê³„ ìë™ ê³„ì‚°'], risks: 'ë¹„íšŒì›â†”íšŒì› ì „í™˜ ì‹œ ì¥ë°”êµ¬ë‹ˆ ë³‘í•© í•„ìš”', acceptance: 'ìƒí’ˆì¶”ê°€â†’ìˆ˜ëŸ‰ë³€ê²½â†’ì˜µì…˜â†’í•©ê³„â†’ê²°ì œì—°ë™ ì •ìƒ' },
  'ëŒ€ì‹œë³´ë“œ': { desc: 'KPI ì‹œê°í™”(ì°¨íŠ¸), ì‹¤ì‹œê°„ ëª¨ë‹ˆí„°ë§, ë¦¬í¬íŠ¸', complexity: 'â˜…â˜…â˜…â˜…â˜†', weeks: '2~3ì£¼', subFeatures: ['í•µì‹¬ KPI ì°¨íŠ¸', 'ê¸°ê°„ë³„ í•„í„°', 'ì‹¤ì‹œê°„ ê°±ì‹ ', 'ë¦¬í¬íŠ¸ ë‹¤ìš´ë¡œë“œ'], risks: 'ë°ì´í„° ì–‘ì— ë”°ë¼ ì¿¼ë¦¬ ìµœì í™” í•„ìš”', acceptance: 'ë°ì´í„°ë¡œë”©â†’ì°¨íŠ¸â†’í•„í„°â†’ë¦¬í¬íŠ¸ë‹¤ìš´ë¡œë“œ 3ì´ˆ ì´ë‚´' },
  'ì •ì‚°': { desc: 'íŒë§¤ì ì •ì‚°, ìˆ˜ìˆ˜ë£Œ ê³„ì‚°, ì •ì‚° ì£¼ê¸°, ì„¸ê¸ˆê³„ì‚°ì„œ', complexity: 'â˜…â˜…â˜…â˜…â˜…', weeks: '3~4ì£¼', subFeatures: ['íŒë§¤ìë³„ ì •ì‚°', 'ìˆ˜ìˆ˜ë£Œ ìë™ ê³„ì‚°', 'ì •ì‚° ì£¼ê¸°', 'ì •ì‚° ë¦¬í¬íŠ¸', 'ì„¸ê¸ˆê³„ì‚°ì„œ'], risks: 'ì„¸ë¬´/íšŒê³„ ê·œì • ì¤€ìˆ˜, ì˜¤ì°¨ 0ì› ì •ë°€ë„', acceptance: 'ë§¤ì¶œì§‘ê³„â†’ìˆ˜ìˆ˜ë£Œâ†’ì •ì‚°ê¸ˆâ†’ì„¸ê¸ˆê³„ì‚°ì„œ ì •ìƒ' },
  'ì¶”ì²œ': { desc: 'ì‚¬ìš©ì í–‰ë™ ê¸°ë°˜ ì¶”ì²œ, ìœ ì‚¬ ì•„ì´í…œ, ê°œì¸í™” í”¼ë“œ', complexity: 'â˜…â˜…â˜…â˜…â˜†', weeks: '2~4ì£¼', subFeatures: ['í–‰ë™ ë°ì´í„° ìˆ˜ì§‘', 'ìœ ì‚¬ ì•„ì´í…œ ì¶”ì²œ', 'ê°œì¸í™” í”¼ë“œ', 'ì¶”ì²œ ì„±ê³¼ ë¶„ì„'], risks: 'ì´ˆê¸° ê·œì¹™ ê¸°ë°˜ â†’ ë°ì´í„° ì¶•ì  í›„ ML ì „í™˜', acceptance: 'í–‰ë™ìˆ˜ì§‘â†’ì¶”ì²œìƒì„±â†’í”¼ë“œë…¸ì¶œâ†’ì„±ê³¼ì¸¡ì • ì •ìƒ' },
  'ì¿ í°': { desc: 'ì¿ í° ë°œê¸‰/ì‚¬ìš©/ë§Œë£Œ, í• ì¸ìœ¨/ê¸ˆì•¡, ì‚¬ìš© ì¡°ê±´', complexity: 'â˜…â˜…â˜†â˜†â˜†', weeks: '1ì£¼', subFeatures: ['ì¿ í° ì½”ë“œ ìƒì„±', 'í• ì¸ ì ìš©', 'ìœ íš¨ê¸°ê°„', 'ì‚¬ìš© ì¡°ê±´', 'ì‚¬ìš© ë‚´ì—­'], risks: 'ì¿ í° ì¤‘ë³µ ì‚¬ìš© ë°©ì§€ í•„ìˆ˜', acceptance: 'ì¿ í°ë°œê¸‰â†’ì ìš©â†’í• ì¸ë°˜ì˜â†’ì‚¬ìš©ë‚´ì—­ ì •ìƒ' },
};

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  ğŸ†• ì„œë¹„ìŠ¤ í‚¤ì›Œë“œ ê¸°ë°˜ ë§ì¶¤ ê¸°ëŠ¥ ì¶”ì²œ DB (v11)
//  "ë°°ë‹¬ ì•±"ì´ë©´ ë°°ë‹¬ ì•± ì „ìš© ê¸°ëŠ¥ì„, "êµìœ¡ í”Œë«í¼"ì´ë©´ êµìœ¡ ì „ìš© ê¸°ëŠ¥ì„ ì¶”ì²œ
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
interface ServiceFeatureSet {
  keywords: string[];  // ë§¤ì¹­ í‚¤ì›Œë“œ
  label: string;       // ì„œë¹„ìŠ¤ ì¹´í…Œê³ ë¦¬ ë¼ë²¨
  must: { name: string; desc: string }[];       // í•„ìˆ˜ ê¸°ëŠ¥
  recommended: { name: string; desc: string }[]; // ì¶”ì²œ ê¸°ëŠ¥
}

const SERVICE_FEATURES_DB: ServiceFeatureSet[] = [
  {
    keywords: ['ë°°ë‹¬', 'ë”œë¦¬ë²„ë¦¬', 'delivery', 'ìŒì‹ ì£¼ë¬¸', 'ë°°ë¯¼', 'ìš”ê¸°ìš”', 'ì¿ íŒ¡ì´ì¸ ', 'í‘¸ë“œ'],
    label: 'ë°°ë‹¬/ìŒì‹ ì£¼ë¬¸ ì„œë¹„ìŠ¤',
    must: [
      { name: 'ì‹¤ì‹œê°„ ì£¼ë¬¸ ê´€ë¦¬', desc: 'ì£¼ë¬¸ ì ‘ìˆ˜â†’ì¡°ë¦¬â†’ë°°ë‹¬ ìƒíƒœ ì‹¤ì‹œê°„ ì¶”ì ' },
      { name: 'ì§€ë„/ìœ„ì¹˜ ê¸°ë°˜ ë°°ë‹¬ ì¶”ì ', desc: 'GPS ê¸°ë°˜ ë¼ì´ë” ìœ„ì¹˜ ì‹¤ì‹œê°„ í‘œì‹œ' },
      { name: 'ê²°ì œ ì‹œìŠ¤í…œ', desc: 'ì¹´ë“œ/ê°„í¸ê²°ì œ/ê³„ì¢Œì´ì²´ PG ì—°ë™' },
      { name: 'ë§¤ì¥/ë©”ë‰´ ê´€ë¦¬', desc: 'ë©”ë‰´ ë“±ë¡, ê°€ê²©, ì˜µì…˜, í’ˆì ˆ ê´€ë¦¬' },
    ],
    recommended: [
      { name: 'ë¦¬ë·°/ë³„ì ', desc: 'ë°°ë‹¬ ì™„ë£Œ í›„ ìŒì‹Â·ë°°ë‹¬ í‰ê°€' },
      { name: 'ì¿ í°/í”„ë¡œëª¨ì…˜', desc: 'í• ì¸ ì¿ í°, ì²« ì£¼ë¬¸ ì´ë²¤íŠ¸' },
      { name: 'ì°œ/ì¦ê²¨ì°¾ê¸°', desc: 'ìì£¼ ì‹œí‚¤ëŠ” ë§¤ì¥ ì €ì¥' },
      { name: 'ì£¼ë¬¸ ë‚´ì—­/ì¬ì£¼ë¬¸', desc: 'ì´ì „ ì£¼ë¬¸ ê¸°ë°˜ ì›í´ë¦­ ì¬ì£¼ë¬¸' },
      { name: 'í‘¸ì‹œ ì•Œë¦¼', desc: 'ì£¼ë¬¸ ìƒíƒœ ë³€ê²½, í”„ë¡œëª¨ì…˜ ì•Œë¦¼' },
      { name: 'ë¼ì´ë” ë§¤ì¹­ ì‹œìŠ¤í…œ', desc: 'ë°°ë‹¬ ë¼ì´ë” ìë™/ìˆ˜ë™ ë°°ì •' },
    ],
  },
  {
    keywords: ['êµìœ¡', 'ê°•ì˜', 'í•™ìŠµ', 'lms', 'ì¸ê°•', 'ì˜¨ë¼ì¸ ìˆ˜ì—…', 'í´ë˜ìŠ¤', 'e-learning', 'ê³¼ì™¸', 'íŠœí„°'],
    label: 'êµìœ¡/í•™ìŠµ í”Œë«í¼',
    must: [
      { name: 'ê°•ì˜ ì˜ìƒ í”Œë ˆì´ì–´', desc: 'ë™ì˜ìƒ ìŠ¤íŠ¸ë¦¬ë°, ë°°ì†, ì´ì–´ë³´ê¸°' },
      { name: 'ìˆ˜ê°• ê´€ë¦¬', desc: 'ìˆ˜ê°•ì‹ ì²­, ì§„ë„ìœ¨ ì¶”ì , ìˆ˜ë£Œì¦' },
      { name: 'íšŒì›/ë¡œê·¸ì¸', desc: 'í•™ìƒÂ·ê°•ì‚¬ ì—­í•  ë¶„ë¦¬, ì†Œì…œ ë¡œê·¸ì¸' },
      { name: 'ê²°ì œ/ìˆ˜ê°•ê¶Œ', desc: 'ê°•ì˜ êµ¬ë§¤, êµ¬ë…, ì¿ í° ì ìš©' },
    ],
    recommended: [
      { name: 'ê³¼ì œ/í€´ì¦ˆ', desc: 'ê³¼ì œ ì œì¶œ, ìë™ ì±„ì  í€´ì¦ˆ' },
      { name: 'ì‹¤ì‹œê°„ í™”ìƒ ìˆ˜ì—…', desc: 'WebRTC ê¸°ë°˜ ë¼ì´ë¸Œ í´ë˜ìŠ¤' },
      { name: 'ìˆ˜ê°• í›„ê¸°/ë³„ì ', desc: 'ê°•ì˜ í‰ê°€ ë° ë¦¬ë·°' },
      { name: 'ê°•ì‚¬ ëŒ€ì‹œë³´ë“œ', desc: 'ë§¤ì¶œ, ìˆ˜ê°•ìƒ í˜„í™©, ê°•ì˜ ê´€ë¦¬' },
      { name: 'ì•Œë¦¼', desc: 'ìƒˆ ê°•ì˜, ê³¼ì œ ë§ˆê°, ê³µì§€ì‚¬í•­ ì•Œë¦¼' },
      { name: 'Q&A ê²Œì‹œíŒ', desc: 'ê°•ì˜ë³„ ì§ˆë¬¸/ë‹µë³€ ì»¤ë®¤ë‹ˆí‹°' },
    ],
  },
  {
    keywords: ['ì˜ˆì•½', 'ë¶€í‚¹', 'booking', 'ë³‘ì›', 'ë¯¸ìš©ì‹¤', 'ìˆ™ì†Œ', 'í˜¸í…”', 'íœì…˜', 'ìº í•‘', 'ì‹ë‹¹', 'ë ˆìŠ¤í† ë‘'],
    label: 'ì˜ˆì•½ ì„œë¹„ìŠ¤',
    must: [
      { name: 'ìº˜ë¦°ë” ì˜ˆì•½ ì‹œìŠ¤í…œ', desc: 'ë‚ ì§œ/ì‹œê°„ ì„ íƒ, ì‹¤ì‹œê°„ ê°€ìš©ì„±' },
      { name: 'ì˜ˆì•½ ê´€ë¦¬', desc: 'ì˜ˆì•½ í™•ì¸/ë³€ê²½/ì·¨ì†Œ, ë…¸ì‡¼ ê´€ë¦¬' },
      { name: 'íšŒì›/ë¡œê·¸ì¸', desc: 'ì˜ˆì•½ì ì •ë³´ ê´€ë¦¬, ì†Œì…œ ë¡œê·¸ì¸' },
      { name: 'ì•Œë¦¼/ë¦¬ë§ˆì¸ë”', desc: 'ì˜ˆì•½ í™•ì¸, ë°©ë¬¸ ì „ ë¦¬ë§ˆì¸ë“œ' },
    ],
    recommended: [
      { name: 'ê²°ì œ/ì„ ê²°ì œ', desc: 'ì˜ˆì•½ ì‹œ ê²°ì œ ë˜ëŠ” í˜„ì¥ ê²°ì œ' },
      { name: 'ë¦¬ë·°/ë³„ì ', desc: 'ë°©ë¬¸ í›„ ì„œë¹„ìŠ¤ í‰ê°€' },
      { name: 'ì—…ì²´ ê´€ë¦¬ í˜ì´ì§€', desc: 'ì˜ˆì•½ í˜„í™©, ìŠ¤ì¼€ì¤„, ê³ ê° ê´€ë¦¬' },
      { name: 'ì§€ë„/ìœ„ì¹˜', desc: 'ë§¤ì¥ ìœ„ì¹˜ í‘œì‹œ, ê¸¸ì°¾ê¸°' },
      { name: 'ëŒ€ê¸°ì—´ ì‹œìŠ¤í…œ', desc: 'ëŒ€ê¸° ë²ˆí˜¸ ë°œê¸‰, ì‹¤ì‹œê°„ ìˆœë²ˆ' },
      { name: 'ì¿ í°/í˜œíƒ', desc: 'ì¬ë°©ë¬¸ í• ì¸, ì²« ì˜ˆì•½ ì¿ í°' },
    ],
  },
  {
    keywords: ['ì‡¼í•‘', 'ì»¤ë¨¸ìŠ¤', 'ì‡¼í•‘ëª°', 'íŒë§¤', 'ìƒí’ˆ', 'e-commerce', 'ìŠ¤í† ì–´', 'ë§ˆì¼“', 'êµ¬ë§¤'],
    label: 'ì‡¼í•‘/ì´ì»¤ë¨¸ìŠ¤',
    must: [
      { name: 'ìƒí’ˆ ë“±ë¡/ê´€ë¦¬', desc: 'ìƒí’ˆ ì •ë³´, ì´ë¯¸ì§€, ì˜µì…˜, ì¬ê³ ' },
      { name: 'ì¥ë°”êµ¬ë‹ˆ/ê²°ì œ', desc: 'ì¥ë°”êµ¬ë‹ˆ, PG ì—°ë™, ê°„í¸ê²°ì œ' },
      { name: 'ì£¼ë¬¸/ë°°ì†¡ ê´€ë¦¬', desc: 'ì£¼ë¬¸ ìƒíƒœ, ì†¡ì¥ ë“±ë¡, ë°°ì†¡ ì¶”ì ' },
      { name: 'íšŒì›/ë¡œê·¸ì¸', desc: 'ì†Œì…œ ë¡œê·¸ì¸, íšŒì› ë“±ê¸‰, ë§ˆì´í˜ì´ì§€' },
    ],
    recommended: [
      { name: 'ê²€ìƒ‰/í•„í„°', desc: 'ìƒí’ˆ ê²€ìƒ‰, ì¹´í…Œê³ ë¦¬, ê°€ê²© í•„í„°' },
      { name: 'ë¦¬ë·°/ë³„ì ', desc: 'ìƒí’ˆ ë¦¬ë·°, í¬í†  ë¦¬ë·°, í‰ì ' },
      { name: 'ì°œ/ìœ„ì‹œë¦¬ìŠ¤íŠ¸', desc: 'ê´€ì‹¬ ìƒí’ˆ ì €ì¥' },
      { name: 'ì¿ í°/í”„ë¡œëª¨ì…˜', desc: 'í• ì¸ ì¿ í°, í¬ì¸íŠ¸, ì ë¦½ê¸ˆ' },
      { name: 'ì¶”ì²œ ì‹œìŠ¤í…œ', desc: 'ë§ì¶¤ ìƒí’ˆ ì¶”ì²œ, ì—°ê´€ ìƒí’ˆ' },
      { name: 'íŒë§¤ì ì •ì‚°', desc: 'ìˆ˜ìˆ˜ë£Œ ê³„ì‚°, ì •ì‚° ë¦¬í¬íŠ¸' },
    ],
  },
  {
    keywords: ['ë§¤ì¹­', 'ì¤‘ê°œ', 'ë§ˆì¼“í”Œë ˆì´ìŠ¤', 'ì—°ê²°', 'í”Œë«í¼', 'í”„ë¦¬ëœì„œ', 'êµ¬ì¸', 'êµ¬ì§', 'ì†Œê°œíŒ…', 'ì¸ë ¥'],
    label: 'ë§¤ì¹­/ì¤‘ê°œ í”Œë«í¼',
    must: [
      { name: 'í”„ë¡œí•„ ì‹œìŠ¤í…œ', desc: 'ê³µê¸‰ì/ìˆ˜ìš”ì í”„ë¡œí•„, í¬íŠ¸í´ë¦¬ì˜¤' },
      { name: 'ë§¤ì¹­/ê²€ìƒ‰', desc: 'ì¡°ê±´ ê¸°ë°˜ ë§¤ì¹­, í•„í„° ê²€ìƒ‰' },
      { name: 'ì±„íŒ…/ë©”ì‹œì§€', desc: 'ë§¤ì¹­ í›„ 1:1 ì‹¤ì‹œê°„ ëŒ€í™”' },
      { name: 'íšŒì›/ì—­í•  ë¶„ë¦¬', desc: 'ê³µê¸‰ìÂ·ìˆ˜ìš”ì ë³„ë„ ê°€ì…/ê´€ë¦¬' },
    ],
    recommended: [
      { name: 'ê²°ì œ/ì—ìŠ¤í¬ë¡œ', desc: 'ì•ˆì „ê²°ì œ, ì¤‘ê°œ ìˆ˜ìˆ˜ë£Œ ì²˜ë¦¬' },
      { name: 'ë¦¬ë·°/í‰íŒ', desc: 'ê±°ë˜ í›„ ìƒí˜¸ í‰ê°€' },
      { name: 'ì•Œë¦¼', desc: 'ìƒˆ ë§¤ì¹­, ë©”ì‹œì§€, ê±°ë˜ ìƒíƒœ ì•Œë¦¼' },
      { name: 'ê´€ë¦¬ì ëŒ€ì‹œë³´ë“œ', desc: 'ë§¤ì¹­ í˜„í™©, ë¶„ìŸ ê´€ë¦¬, í†µê³„' },
      { name: 'í¬íŠ¸í´ë¦¬ì˜¤/ì‹¤ì ', desc: 'ê³µê¸‰ì ì‘ì—…ë¬¼, ê²½ë ¥ í‘œì‹œ' },
      { name: 'ê²¬ì /ì œì•ˆì„œ', desc: 'ìˆ˜ìš”ìì—ê²Œ ê²¬ì  ë³´ë‚´ê¸°' },
    ],
  },
  {
    keywords: ['ì±„íŒ…', 'sns', 'ì†Œì…œ', 'ì»¤ë®¤ë‹ˆí‹°', 'ë©”ì‹ ì €', 'ì¹´í†¡', 'ì¸ìŠ¤íƒ€', 'í”¼ë“œ', 'ì†Œí†µ'],
    label: 'SNS/ì»¤ë®¤ë‹ˆí‹°',
    must: [
      { name: 'ì‹¤ì‹œê°„ ì±„íŒ…', desc: '1:1/ê·¸ë£¹ ë©”ì‹œì§€, ì½ìŒ í™•ì¸' },
      { name: 'í”¼ë“œ/íƒ€ì„ë¼ì¸', desc: 'ê²Œì‹œë¬¼ ì‘ì„±, ì¢‹ì•„ìš”, ëŒ“ê¸€' },
      { name: 'íšŒì›/í”„ë¡œí•„', desc: 'í”„ë¡œí•„, íŒ”ë¡œìš°/íŒ”ë¡œì‰' },
      { name: 'ì•Œë¦¼ ì‹œìŠ¤í…œ', desc: 'ì¢‹ì•„ìš”, ëŒ“ê¸€, DM ì•Œë¦¼' },
    ],
    recommended: [
      { name: 'ì´ë¯¸ì§€/ì˜ìƒ ì—…ë¡œë“œ', desc: 'ë¯¸ë””ì–´ ì²¨ë¶€, ê°¤ëŸ¬ë¦¬' },
      { name: 'í•´ì‹œíƒœê·¸/ê²€ìƒ‰', desc: 'íƒœê·¸ ê¸°ë°˜ ì½˜í…ì¸  íƒìƒ‰' },
      { name: 'ìŠ¤í† ë¦¬/ìˆí¼', desc: '24ì‹œê°„ ì‚¬ë¼ì§€ëŠ” ì½˜í…ì¸ ' },
      { name: 'ì‹ ê³ /ì°¨ë‹¨', desc: 'ìœ í•´ ì½˜í…ì¸  ì‹ ê³ , ì‚¬ìš©ì ì°¨ë‹¨' },
      { name: 'ê·¸ë£¹/ì±„ë„', desc: 'ê´€ì‹¬ì‚¬ ê¸°ë°˜ ê·¸ë£¹ ìƒì„±' },
      { name: 'í‘¸ì‹œ ì•Œë¦¼', desc: 'ì‹¤ì‹œê°„ í™œë™ ì•Œë¦¼' },
    ],
  },
  {
    keywords: ['ê±´ê°•', 'í—¬ìŠ¤', 'ìš´ë™', 'í”¼íŠ¸ë‹ˆìŠ¤', 'ë‹¤ì´ì–´íŠ¸', 'ì˜ë£Œ', 'ë³‘ì›', 'ì§„ë£Œ', 'ì•½', 'ì¼€ì–´'],
    label: 'ê±´ê°•/í—¬ìŠ¤ì¼€ì–´',
    must: [
      { name: 'ê±´ê°• ê¸°ë¡ ê´€ë¦¬', desc: 'ìš´ë™/ì‹ë‹¨/ìˆ˜ë©´/ì²´ì¤‘ ê¸°ë¡' },
      { name: 'íšŒì›/ë¡œê·¸ì¸', desc: 'ê°œì¸ ê±´ê°• ë°ì´í„° ë³´í˜¸, ì†Œì…œ ë¡œê·¸ì¸' },
      { name: 'ëŒ€ì‹œë³´ë“œ/í†µê³„', desc: 'ê±´ê°• ë°ì´í„° ì‹œê°í™”, ì¶”ì´ ë¶„ì„' },
      { name: 'ì•Œë¦¼/ë¦¬ë§ˆì¸ë”', desc: 'ìš´ë™, ì•½ ë³µìš©, ê²€ì§„ ë¦¬ë§ˆì¸ë”' },
    ],
    recommended: [
      { name: 'ìš´ë™ í”„ë¡œê·¸ë¨', desc: 'ë£¨í‹´ ì¶”ì²œ, ì˜ìƒ ê°€ì´ë“œ' },
      { name: 'ì „ë¬¸ê°€ ìƒë‹´', desc: 'ì˜ì‚¬/íŠ¸ë ˆì´ë„ˆ 1:1 ìƒë‹´' },
      { name: 'ì˜ˆì•½ ì‹œìŠ¤í…œ', desc: 'ì§„ë£Œ/PT ì˜ˆì•½' },
      { name: 'ì›¨ì–´ëŸ¬ë¸” ì—°ë™', desc: 'ìŠ¤ë§ˆíŠ¸ì›Œì¹˜ ë°ì´í„° ë™ê¸°í™”' },
      { name: 'ì»¤ë®¤ë‹ˆí‹°', desc: 'ê±´ê°• íŒ ê³µìœ , ì±Œë¦°ì§€' },
      { name: 'ê²°ì œ/êµ¬ë…', desc: 'í”„ë¦¬ë¯¸ì—„ í”Œëœ, ìƒë‹´ ê²°ì œ' },
    ],
  },
  {
    keywords: ['saas', 'b2b', 'ëŒ€ì‹œë³´ë“œ', 'ê´€ë¦¬', 'êµ¬ë…', 'ë¹„ì¦ˆë‹ˆìŠ¤', 'ì—…ë¬´', 'crm', 'erp', 'ì¸ì‚¬', 'íšŒê³„'],
    label: 'SaaS/B2B ì„œë¹„ìŠ¤',
    must: [
      { name: 'íŒ€/ì¡°ì§ ê´€ë¦¬', desc: 'ì›Œí¬ìŠ¤í˜ì´ìŠ¤, ë©¤ë²„ ì´ˆëŒ€, ê¶Œí•œ' },
      { name: 'ëŒ€ì‹œë³´ë“œ', desc: 'í•µì‹¬ KPI, ë°ì´í„° ì‹œê°í™”' },
      { name: 'íšŒì›/ì¸ì¦', desc: 'SSO, 2FA, ì—­í•  ê¸°ë°˜ ì ‘ê·¼ ì œì–´' },
      { name: 'êµ¬ë…/ê³¼ê¸ˆ', desc: 'í”Œëœë³„ ê³¼ê¸ˆ, ê²°ì œ, ì¸ë³´ì´ìŠ¤' },
    ],
    recommended: [
      { name: 'API ì—°ë™', desc: 'ì™¸ë¶€ ì„œë¹„ìŠ¤ ì—°ë™, ì›¹í›…' },
      { name: 'ë¦¬í¬íŠ¸/ë‚´ë³´ë‚´ê¸°', desc: 'PDF/Excel ë¦¬í¬íŠ¸ ìƒì„±' },
      { name: 'ì•Œë¦¼/Slack ì—°ë™', desc: 'ì´ë²¤íŠ¸ ì•Œë¦¼, ë©”ì‹ ì € í†µí•©' },
      { name: 'ê°ì‚¬ ë¡œê·¸', desc: 'ì‘ì—… ì´ë ¥, ë³€ê²½ ì¶”ì ' },
      { name: 'ì˜¨ë³´ë”© ê°€ì´ë“œ', desc: 'ì‚¬ìš©ì íŠœí† ë¦¬ì–¼, ë„ì›€ë§' },
      { name: 'ë©€í‹° í…Œë„Œì‹œ', desc: 'ê³ ê°ì‚¬ë³„ ë°ì´í„° ê²©ë¦¬' },
    ],
  },
  {
    keywords: ['ai', 'ì¸ê³µì§€ëŠ¥', 'gpt', 'ì±—ë´‡', 'llm', 'ë¨¸ì‹ ëŸ¬ë‹', 'ìë™í™”', 'ìƒì„±'],
    label: 'AI ì„œë¹„ìŠ¤',
    must: [
      { name: 'AI ì²˜ë¦¬ ì—”ì§„', desc: 'LLM/ML ëª¨ë¸ ì—°ë™, API í˜¸ì¶œ' },
      { name: 'ì…ë ¥/ì¶œë ¥ ì¸í„°í˜ì´ìŠ¤', desc: 'í…ìŠ¤íŠ¸Â·íŒŒì¼ ì…ë ¥, ê²°ê³¼ í‘œì‹œ' },
      { name: 'íšŒì›/ì‚¬ìš©ëŸ‰ ê´€ë¦¬', desc: 'ë¡œê·¸ì¸, API í¬ë ˆë”§, ì‚¬ìš© ì´ë ¥' },
      { name: 'ê²°ê³¼ ì €ì¥/ë‚´ë³´ë‚´ê¸°', desc: 'AI ê²°ê³¼ë¬¼ ì €ì¥, ë‹¤ìš´ë¡œë“œ' },
    ],
    recommended: [
      { name: 'í”„ë¡¬í”„íŠ¸ í…œí”Œë¦¿', desc: 'ìì£¼ ì“°ëŠ” ì§ˆë¬¸/ëª…ë ¹ì–´ ì €ì¥' },
      { name: 'íˆìŠ¤í† ë¦¬', desc: 'ì´ì „ ëŒ€í™”/ìƒì„± ë‚´ì—­ ê´€ë¦¬' },
      { name: 'ê²°ì œ/êµ¬ë…', desc: 'API í¬ë ˆë”§ ì¶©ì „, í”„ë¦¬ë¯¸ì—„ í”Œëœ' },
      { name: 'ê³µìœ /í˜‘ì—…', desc: 'ê²°ê³¼ë¬¼ ê³µìœ , íŒ€ ì›Œí¬ìŠ¤í˜ì´ìŠ¤' },
      { name: 'íŒŒì¼ ì—…ë¡œë“œ', desc: 'ë¬¸ì„œ/ì´ë¯¸ì§€ ë¶„ì„ìš© ì—…ë¡œë“œ' },
      { name: 'ê´€ë¦¬ì í†µê³„', desc: 'ì‚¬ìš©ëŸ‰, ë¹„ìš©, ì„±ê³¼ ëŒ€ì‹œë³´ë“œ' },
    ],
  },
];

/**
 * ì„œë¹„ìŠ¤ ì„¤ëª…(overview)ì—ì„œ í‚¤ì›Œë“œë¥¼ ë¶„ì„í•˜ì—¬
 * í•´ë‹¹ ì„œë¹„ìŠ¤ì— ë§ëŠ” ë§ì¶¤ ê¸°ëŠ¥ ëª©ë¡ì„ ë°˜í™˜
 */
function getServiceFeatures(overviewText: string): { label: string; features: SelectableFeature[] } | null {
  const t = overviewText.toLowerCase();

  let bestMatch: ServiceFeatureSet | null = null;
  let bestScore = 0;

  for (const service of SERVICE_FEATURES_DB) {
    let score = 0;
    for (const kw of service.keywords) {
      if (t.includes(kw)) score += kw.length; // ê¸´ í‚¤ì›Œë“œì¼ìˆ˜ë¡ ë†’ì€ ì ìˆ˜
    }
    if (score > bestScore) {
      bestScore = score;
      bestMatch = service;
    }
  }

  if (!bestMatch || bestScore === 0) return null;

  const features: SelectableFeature[] = [
    ...bestMatch.must.map(f => ({ name: f.name, desc: f.desc, category: 'must' as const })),
    ...bestMatch.recommended.map(f => ({ name: f.name, desc: f.desc, category: 'recommended' as const })),
  ];

  return { label: bestMatch.label, features };
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  í”„ë¡œì íŠ¸ ìœ í˜• ê°ì§€ (ê¸°ì¡´ ìœ ì§€)
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function detectProjectType(text: string): { projectType: string; typeInfo: ProjectTypeInfo; confidence: string } {
  const t = text.trim().toLowerCase();
  const keywords: [string, string, number][] = [
    ['ì•±', 'ëª¨ë°”ì¼ ì•±', 3], ['ì–´í”Œ', 'ëª¨ë°”ì¼ ì•±', 5], ['ëª¨ë°”ì¼', 'ëª¨ë°”ì¼ ì•±', 4], ['ios', 'ëª¨ë°”ì¼ ì•±', 5], ['ì•ˆë“œë¡œì´ë“œ', 'ëª¨ë°”ì¼ ì•±', 5],
    ['ì›¹ì‚¬ì´íŠ¸', 'ì›¹ì‚¬ì´íŠ¸', 5], ['í™ˆí˜ì´ì§€', 'ì›¹ì‚¬ì´íŠ¸', 5], ['ëœë”©', 'ì›¹ì‚¬ì´íŠ¸', 4],
    ['ì›¹', 'ì›¹ ì„œë¹„ìŠ¤', 3], ['ì‚¬ì´íŠ¸', 'ì›¹ ì„œë¹„ìŠ¤', 2],
    ['ì‡¼í•‘ëª°', 'ì´ì»¤ë¨¸ìŠ¤', 5], ['ì»¤ë¨¸ìŠ¤', 'ì´ì»¤ë¨¸ìŠ¤', 5], ['ì‡¼í•‘', 'ì´ì»¤ë¨¸ìŠ¤', 4], ['íŒë§¤', 'ì´ì»¤ë¨¸ìŠ¤', 3], ['ìƒí’ˆ', 'ì´ì»¤ë¨¸ìŠ¤', 3],
    ['í”Œë«í¼', 'í”Œë«í¼', 3], ['ë§ˆì¼“í”Œë ˆì´ìŠ¤', 'í”Œë«í¼', 5], ['ì¤‘ê°œ', 'í”Œë«í¼', 3],
    ['saas', 'SaaS', 5], ['êµ¬ë…', 'SaaS', 3], ['b2b', 'SaaS', 3], ['ëŒ€ì‹œë³´ë“œ', 'SaaS', 2],
    ['ë§¤ì¹­', 'í”Œë«í¼', 5], ['ì—°ê²°', 'í”Œë«í¼', 2],
    ['ì˜ˆì•½', 'ì›¹ ì„œë¹„ìŠ¤', 3], ['ë¶€í‚¹', 'ì›¹ ì„œë¹„ìŠ¤', 3],
    ['êµìœ¡', 'ì›¹ ì„œë¹„ìŠ¤', 3], ['í•™ìŠµ', 'ì›¹ ì„œë¹„ìŠ¤', 3], ['ê°•ì˜', 'ì›¹ ì„œë¹„ìŠ¤', 4],
    ['í—¬ìŠ¤', 'ì›¹ ì„œë¹„ìŠ¤', 3], ['ê±´ê°•', 'ì›¹ ì„œë¹„ìŠ¤', 2], ['ì˜ë£Œ', 'ì›¹ ì„œë¹„ìŠ¤', 4],
    ['ê¸ˆìœµ', 'ì›¹ ì„œë¹„ìŠ¤', 3], ['í•€í…Œí¬', 'ì›¹ ì„œë¹„ìŠ¤', 4], ['íˆ¬ì', 'ì›¹ ì„œë¹„ìŠ¤', 2],
    ['ai', 'AI ì„œë¹„ìŠ¤', 4], ['ì±—ë´‡', 'AI ì„œë¹„ìŠ¤', 5], ['ì¸ê³µì§€ëŠ¥', 'AI ì„œë¹„ìŠ¤', 5], ['gpt', 'AI ì„œë¹„ìŠ¤', 5],
  ];

  const scores: Record<string, number> = {};
  for (const [key, val, weight] of keywords) {
    if (t.includes(key)) scores[val] = (scores[val] || 0) + weight;
  }

  let projectType = 'ì†Œí”„íŠ¸ì›¨ì–´ ì„œë¹„ìŠ¤';
  let maxScore = 0;
  for (const [type, score] of Object.entries(scores)) {
    if (score > maxScore) { maxScore = score; projectType = type; }
  }

  const confidence = maxScore >= 5 ? 'ë†’ìŒ' : maxScore >= 3 ? 'ì¤‘ê°„' : 'ë‚®ìŒ';
  const typeInfo = PROJECT_TYPES[projectType] || DEFAULT_PROJECT_TYPE;

  return { projectType, typeInfo, confidence };
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  ê¸°ëŠ¥ íŒŒì‹± (ê¸°ì¡´ ìœ ì§€)
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function parseFeatures(text: string): { name: string; description: string; priority: 'P1' | 'P2' | 'P3' }[] {
  let items = text.split(/[\n]/).map(s => s.trim()).filter(Boolean);
  if (items.length === 1) items = text.split(/[,ï¼Œ/Â·â€¢\-]/).map(s => s.trim()).filter(s => s.length > 1);
  items = items.map(s => s.replace(/^[\dâ‘ â‘¡â‘¢â‘£â‘¤â‘¥â‘¦â‘§â‘¨â‘©]+[\.\)]\s*/, '').trim());

  return items.slice(0, 10).map((raw, i) => {
    const name = raw.length > 50 ? raw.slice(0, 50) : raw;
    let matchedFeature: (typeof FEATURE_DB)[string] | null = null;
    for (const [keyword, info] of Object.entries(FEATURE_DB)) {
      if (raw.includes(keyword)) { matchedFeature = info; break; }
    }
    const description = matchedFeature
      ? `${matchedFeature.desc} [${matchedFeature.complexity} | ${matchedFeature.weeks}]`
      : `${raw} â€” ìƒì„¸ ìš”êµ¬ì‚¬í•­ì€ ê°œë°œì‚¬ì™€ í˜‘ì˜ í•„ìš” [â˜…â˜…â˜…â˜†â˜† | 1~2ì£¼(ì¶”ì •)]`;
    return { name, description, priority: i < 2 ? 'P1' : i < 4 ? 'P2' : 'P3' };
  });
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  ì „ì—­ ëŒ€í™” ìƒíƒœ
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
let detectedType: ProjectTypeInfo | null = null;
let detectedProjectType: string = '';
let previousAnswers: Record<number, string> = {};
let followUpCount: Record<number, number> = {};
// ğŸ†• ê¸°ëŠ¥ ì„ íƒ ì‹œìŠ¤í…œ ìƒíƒœ
let accumulatedFeatures: { name: string; description: string; priority: 'P1' | 'P2' | 'P3' }[] = [];
let featureSelectionActive: boolean = false;

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  ğŸ†• ë™ì  ë‹¤ìŒ í† í”½ ê²°ì • ì—”ì§„
//  rfpDataë¥¼ ë¶„ì„í•˜ì—¬ ê°€ì¥ ê°€ì¹˜ ìˆëŠ” ë‹¤ìŒ ì§ˆë¬¸ì„ ê²°ì •
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function determineNextTopic(rfpData: RFPData, currentTopicStep: number): number | null {
  const ti = detectedType || DEFAULT_PROJECT_TYPE;
  const covered = getTopicsCovered(rfpData);

  // ì™„ë£Œ ê°€ëŠ¥ ì—¬ë¶€ ì²´í¬
  if (isReadyToComplete(rfpData) && covered.length >= 5) {
    return null; // ì™„ë£Œ ì œì•ˆ
  }

  // í”„ë¡œì íŠ¸ ìœ í˜•ë³„ ìš°ì„ ìˆœìœ„ì— ë”°ë¼ ë‹¤ìŒ í† í”½ ì„ íƒ
  const topicOrder = ti.topicPriority;

  for (const topicId of topicOrder) {
    if (!covered.includes(topicId)) {
      return TOPIC_TO_STEP[topicId];
    }
  }

  // ëª¨ë“  í† í”½ì´ ì»¤ë²„ë˜ë©´ ì™„ë£Œ
  return null;
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  ğŸ†• ë§¥ë½ ê¸°ë°˜ ë™ì  ì§ˆë¬¸ ìƒì„±
//  ì´ì „ ë‹µë³€ì„ ì°¸ì¡°í•˜ì—¬ ë§ì¶¤í˜• ì§ˆë¬¸ ìƒì„±
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function generateContextualQuestion(topicStep: number, rfpData: RFPData): { question: string; quickReplies?: string[]; selectableFeatures?: SelectableFeature[] } {
  const ti = detectedType || DEFAULT_PROJECT_TYPE;
  const topicId = STEP_TO_TOPIC[topicStep];
  const projectName = previousAnswers[1] ? previousAnswers[1].slice(0, 20) : 'í”„ë¡œì íŠ¸';

  // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  // í•µì‹¬ ì›ì¹™: PRD ìš”êµ¬ì‚¬í•­ ì •ì˜ì—ë§Œ ì§‘ì¤‘.
  // ê²¬ì , ì˜ˆì‚°, ë¹„ìš©, ì‹œì¥ ì¸ì‚¬ì´íŠ¸ ì–¸ê¸‰ ê¸ˆì§€.
  // "ì™œ ì´ ì •ë³´ê°€ PRDì— í•„ìš”í•œì§€" ì´ìœ ë§Œ ë§í•˜ê³  ì§ˆë¬¸.
  // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

  switch (topicId) {
    case 'targetUsers': {
      if (detectedProjectType === 'í”Œë«í¼') {
        return {
          question: `í”Œë«í¼ì€ **ê³µê¸‰ìì™€ ìˆ˜ìš”ì ì–‘ìª½ì˜ í™”ë©´ì„ ë³„ë„ ì„¤ê³„**í•´ì•¼ í•©ë‹ˆë‹¤.\n\n**${projectName}**ì—ì„œ ë§¤ì¹­ë˜ëŠ” ì–‘ìª½ì€ ê°ê° ëˆ„êµ¬ì¸ê°€ìš”?\nì˜ˆ: "í”„ë¦¬ëœì„œ ê°œë°œì â†” IT ì™¸ì£¼ë¥¼ ì›í•˜ëŠ” ê¸°ì—…"`,
          quickReplies: ti.quickRepliesMap.targetUsers,
        };
      } else if (detectedProjectType === 'ì´ì»¤ë¨¸ìŠ¤') {
        return {
          question: `íƒ€ê²Ÿ ê³ ê°ì— ë”°ë¼ **ìƒí’ˆ ë…¸ì¶œ ë°©ì‹, UI í†¤, í•„ìš” ê¸°ëŠ¥**ì´ ì™„ì „íˆ ë‹¬ë¼ì§‘ë‹ˆë‹¤.\n\n**${projectName}**ì˜ ì£¼ êµ¬ë§¤ìëŠ” ì–´ë–¤ ë¶„ë“¤ì¸ê°€ìš”?\nì—°ë ¹ëŒ€, ì„±ë³„, ì£¼ êµ¬ë§¤ ìƒí™© ë“±ì„ ì•Œë ¤ì£¼ì„¸ìš”.`,
          quickReplies: ti.quickRepliesMap.targetUsers,
        };
      } else if (detectedProjectType === 'SaaS') {
        return {
          question: `SaaSëŠ” **ì˜ì‚¬ê²°ì •ìì™€ ì‹¤ì‚¬ìš©ìê°€ ë‹¤ë¥¸ ê²½ìš°**ê°€ ë§ì•„, ì–‘ìª½ì˜ ë‹ˆì¦ˆë¥¼ íŒŒì•…í•´ì•¼ ê¸°ëŠ¥ ì„¤ê³„ê°€ ì •í™•í•´ì§‘ë‹ˆë‹¤.\n\n**${projectName}**ì„ ì‚¬ìš©í•  ê¸°ì—… ê·œëª¨ì™€ ì‹¤ì‚¬ìš©ìëŠ” ëˆ„êµ¬ì¸ê°€ìš”?`,
          quickReplies: ti.quickRepliesMap.targetUsers,
        };
      } else if (detectedProjectType === 'AI ì„œë¹„ìŠ¤') {
        return {
          question: `ì‚¬ìš©ìì˜ ê¸°ìˆ  ìˆ˜ì¤€ì— ë”°ë¼ **UI ë³µì¡ë„ì™€ ê²°ê³¼ í‘œì‹œ ë°©ì‹**ì´ í¬ê²Œ ë‹¬ë¼ì§‘ë‹ˆë‹¤.\n\n**${projectName}**ì˜ ì‚¬ìš©ìëŠ” AIì— ìµìˆ™í•œ ì „ë¬¸ê°€ì¸ê°€ìš”, ì¼ë°˜ì¸ì¸ê°€ìš”?`,
          quickReplies: ti.quickRepliesMap.targetUsers,
        };
      }
      return {
        question: `íƒ€ê²Ÿ ì‚¬ìš©ìì— ë”°ë¼ **í™”ë©´ êµ¬ì„±ê³¼ ê¸°ëŠ¥ ìš°ì„ ìˆœìœ„**ê°€ ê²°ì •ë©ë‹ˆë‹¤.\n\n**${projectName}**ì„ ì£¼ë¡œ ëˆ„ê°€ ì‚¬ìš©í•˜ê²Œ ë ê¹Œìš”?\nì—°ë ¹ëŒ€, ì§ì—…, ê¸°ìˆ  ìˆ˜ì¤€ ë“±ì„ ì•Œë ¤ì£¼ì„¸ìš”.`,
        quickReplies: ti.quickRepliesMap.targetUsers,
      };
    }

    case 'coreFeatures': {
      // ğŸ†• v11: ì„œë¹„ìŠ¤ ì„¤ëª…(overview) ê¸°ë°˜ ë§ì¶¤ ê¸°ëŠ¥ ì¶”ì²œ
      // CEO: "ì–´ë–¤ ì„œë¹„ìŠ¤ë¥¼ ë§Œë“¤ê³  ì‹¶ì€ê°€ìš”?ì˜ ëŒ€ë‹µì— ë§ëŠ” ê¸°ëŠ¥ ë¦¬ìŠ¤íŠ¸ë¥¼ ë§Œë“¤ì–´ì•¼ì§€"
      const overviewText = previousAnswers[1] || rfpData?.overview || '';
      const serviceMatch = getServiceFeatures(overviewText);

      featureSelectionActive = true;
      accumulatedFeatures = [];

      if (serviceMatch) {
        // ì„œë¹„ìŠ¤ í‚¤ì›Œë“œ ë§¤ì¹­ ì„±ê³µ â†’ ë§ì¶¤ ê¸°ëŠ¥ ëª©ë¡
        const question = `PRDì˜ í•µì‹¬ì€ **ê¸°ëŠ¥ ì •ì˜**ì…ë‹ˆë‹¤.\n\n**"${overviewText.slice(0, 30)}"**ì— ë§ëŠ” **${serviceMatch.label}** ì¶”ì²œ ê¸°ëŠ¥ì„ ì¤€ë¹„í–ˆìŠµë‹ˆë‹¤.\n\nì•„ë˜ì—ì„œ í•„ìš”í•œ ê¸°ëŠ¥ì„ **ì„ íƒ/í•´ì œ**í•œ í›„ í™•ì¸í•´ì£¼ì„¸ìš”.\nì§ì ‘ ì¶”ê°€í•  ê¸°ëŠ¥ì´ ìˆìœ¼ë©´ í…ìŠ¤íŠ¸ë¡œ ì…ë ¥í•˜ì…”ë„ ë©ë‹ˆë‹¤.`;

        return {
          question,
          selectableFeatures: serviceMatch.features,
        };
      } else {
        // ë§¤ì¹­ ì‹¤íŒ¨ â†’ ì¹´í…Œê³ ë¦¬ ê¸°ë°˜ í´ë°± + selectableFeatures
        const mustHave = ti.mustHaveFeatures;
        const quickFeatures = ti.quickRepliesMap.coreFeatures;

        const features: SelectableFeature[] = [
          ...mustHave.map(f => ({ name: f, desc: FEATURE_DB[f.split('(')[0].trim()]?.desc || f, category: 'must' as const })),
          ...quickFeatures.filter(f => !mustHave.includes(f)).map(f => ({ name: f, desc: FEATURE_DB[f.split('(')[0].trim()]?.desc || f, category: 'recommended' as const })),
        ];

        const question = `PRDì˜ í•µì‹¬ì€ **ê¸°ëŠ¥ ì •ì˜**ì…ë‹ˆë‹¤.\n\n**${ti.type}** í”„ë¡œì íŠ¸ì—ì„œ ì¶”ì²œí•˜ëŠ” ê¸°ëŠ¥ ëª©ë¡ì…ë‹ˆë‹¤.\n\nì•„ë˜ì—ì„œ í•„ìš”í•œ ê¸°ëŠ¥ì„ **ì„ íƒ/í•´ì œ**í•œ í›„ í™•ì¸í•´ì£¼ì„¸ìš”.\nì§ì ‘ ì¶”ê°€í•  ê¸°ëŠ¥ì´ ìˆìœ¼ë©´ í…ìŠ¤íŠ¸ë¡œ ì…ë ¥í•˜ì…”ë„ ë©ë‹ˆë‹¤.`;

        return {
          question,
          selectableFeatures: features,
        };
      }
    }

    case 'referenceServices': {
      const typeExample = ti.competitorExample;
      return {
        question: `ì°¸ê³  ì„œë¹„ìŠ¤ê°€ ìˆìœ¼ë©´ **ë””ìì¸ ë°©í–¥ê³¼ ê¸°ëŠ¥ ìˆ˜ì¤€**ì„ PRDì— êµ¬ì²´ì ìœ¼ë¡œ ëª…ì‹œí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.\n\në¹„ìŠ·í•˜ê²Œ ë§Œë“¤ê³  ì‹¶ì€ ì„œë¹„ìŠ¤ê°€ ìˆë‚˜ìš”?\n"${typeExample}ì˜ **ì´ ë¶€ë¶„ì²˜ëŸ¼**" ì‹ìœ¼ë¡œ ë§ì”€í•´ì£¼ì‹œë©´ ê°€ì¥ ì¢‹ìŠµë‹ˆë‹¤.`,
        quickReplies: ti.quickRepliesMap.referenceServices,
      };
    }

    case 'techRequirements': {
      return {
        question: `ì›¹ì¸ì§€ ì•±ì¸ì§€ì— ë”°ë¼ **ê¸°ìˆ  ìŠ¤íƒê³¼ ì„¤ê³„ ë°©ì‹**ì´ ì™„ì „íˆ ë‹¬ë¼ì§‘ë‹ˆë‹¤.\n\n**${projectName}**ì„(ë¥¼) ì›¹ìœ¼ë¡œ ë§Œë“¤ê¹Œìš”, ì•±ìœ¼ë¡œ ë§Œë“¤ê¹Œìš”?\níŠ¹ë³„í•œ ì„ í˜¸ê°€ ì—†ìœ¼ì‹œë©´ "ê°œë°œì‚¬ ì¶”ì²œì— ë”°ë¦„"ë„ ê´œì°®ìŠµë‹ˆë‹¤.`,
        quickReplies: ti.quickRepliesMap.techRequirements,
      };
    }

    case 'budgetTimeline': {
      return {
        question: `ì¼ì •ê³¼ ì˜ˆì‚°ì´ PRDì— í¬í•¨ë˜ì–´ì•¼ **ì‹¤í˜„ ê°€ëŠ¥í•œ ë²”ìœ„**ë¡œ ê¸°ëŠ¥ì„ ì¡°ìœ¨í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.\n\ní¬ë§í•˜ëŠ” ì™„ë£Œ ì‹œì ê³¼ ì˜ˆì‚° ë²”ìœ„ê°€ ìˆìœ¼ì‹ ê°€ìš”?\nëŒ€ëµì ì´ì–´ë„ ê´œì°®ê³ , "ë¯¸ì •"ì´ì…”ë„ ë©ë‹ˆë‹¤.`,
        quickReplies: ti.quickRepliesMap.budgetTimeline,
      };
    }

    case 'additionalRequirements': {
      return {
        question: `PRDì— í¬í•¨í•  **ì¶”ê°€ ì¡°ê±´**ì´ ìˆìœ¼ì‹ ê°€ìš”?\n\nì˜ˆ: ì†ŒìŠ¤ì½”ë“œ ì†Œìœ ê¶Œ, í•˜ìë³´ìˆ˜, ë””ìì¸ í¬í•¨ ì—¬ë¶€, íŠ¹ì • ë³´ì•ˆ ìš”ê±´ ë“±`,
        quickReplies: ti.quickRepliesMap.additionalRequirements,
      };
    }

    default:
      return { question: 'ë‹¤ìŒìœ¼ë¡œ ë„˜ì–´ê°ˆê²Œìš”.' };
  }
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  ğŸ†• ë§¥ë½ ì¸ì§€ ì „ë¬¸ê°€ í”¼ë“œë°± v8
//  ì´ì „ ëª¨ë“  ë‹µë³€ì„ ì°¸ì¡°í•œ ë§ì¶¤ ì¸ì‚¬ì´íŠ¸
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function getContextualFeedback(topicStep: number, answer: string, rfpData: RFPData): { message: string; quickReplies?: string[]; thinkingLabel?: string } {
  const a = answer.trim();
  previousAnswers[topicStep] = a;
  const topicId = STEP_TO_TOPIC[topicStep];

  // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  // í•µì‹¬ ì›ì¹™: PRD ì •ì˜ì—ë§Œ ì§‘ì¤‘.
  // ê²¬ì /ì˜ˆì‚°/ë¹„ìš©/ì‹œì¥ì¸ì‚¬ì´íŠ¸ ì ˆëŒ€ ì–¸ê¸‰ ê¸ˆì§€.
  // í”¼ë“œë°±ì€ "ë°˜ì˜í–ˆìŠµë‹ˆë‹¤" ìˆ˜ì¤€ìœ¼ë¡œ ì§§ê²Œ.
  // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

  switch (topicId) {
    case 'overview': {
      const { projectType, typeInfo } = detectProjectType(a);
      detectedType = typeInfo;
      detectedProjectType = projectType;

      return {
        message: `${typeInfo.insightEmoji} **${typeInfo.type}** í”„ë¡œì íŠ¸ë¡œ íŒŒì•…í–ˆìŠµë‹ˆë‹¤.`,
        thinkingLabel: 'í”„ë¡œì íŠ¸ ìœ í˜• ë¶„ì„ ì¤‘...',
      };
    }

    case 'targetUsers': {
      return {
        message: 'íƒ€ê²Ÿ ì‚¬ìš©ìë¥¼ ë°˜ì˜í–ˆìŠµë‹ˆë‹¤.',
        thinkingLabel: 'ë°˜ì˜ ì¤‘...',
      };
    }

    case 'coreFeatures': {
      // ğŸ†• v11: ë³µìˆ˜ì„ íƒ UIì—ì„œ í•œ ë²ˆì— ì œì¶œë˜ë¯€ë¡œ ë‹¨ìˆœí™”
      // ì…ë ¥: JSON ë°°ì—´ (UIì—ì„œ ì„ íƒ) ë˜ëŠ” ììœ  í…ìŠ¤íŠ¸

      // JSON ë°°ì—´ë¡œ ì˜¨ ê²½ìš° (UI ë³µìˆ˜ì„ íƒ)
      let selectedFeatures: { name: string; desc: string; category: string }[] = [];
      try {
        const parsed = JSON.parse(a);
        if (Array.isArray(parsed)) {
          selectedFeatures = parsed;
        }
      } catch {
        // JSONì´ ì•„ë‹Œ ê²½ìš° â€” ììœ  í…ìŠ¤íŠ¸ ì…ë ¥
      }

      if (selectedFeatures.length > 0) {
        // UIì—ì„œ ì„ íƒëœ ê¸°ëŠ¥ â†’ accumulatedFeaturesë¡œ ë³€í™˜
        accumulatedFeatures = selectedFeatures.map((f, i) => ({
          name: f.name,
          description: f.desc || f.name,
          priority: (f.category === 'must' ? 'P1' : i < 4 ? 'P2' : 'P3') as 'P1' | 'P2' | 'P3',
        }));
        featureSelectionActive = false;
        const selectedList = accumulatedFeatures.map(f => `âœ… ${f.name}`).join('\n');
        return {
          message: `**ì„ íƒ ê¸°ëŠ¥ ${accumulatedFeatures.length}ê°œ ë°˜ì˜ ì™„ë£Œ:**\n${selectedList}`,
          thinkingLabel: 'ê¸°ëŠ¥ ëª©ë¡ ë°˜ì˜ ì¤‘...',
        };
      } else if (a === 'ì§ì ‘ ì…ë ¥í• ê²Œìš”') {
        return {
          message: 'ì›í•˜ì‹œëŠ” ê¸°ëŠ¥ì„ ììœ ë¡­ê²Œ ì…ë ¥í•´ì£¼ì„¸ìš”.\nì—¬ëŸ¬ ê°œë¥¼ ì½¤ë§ˆ(,)ë‚˜ ì¤„ë°”ê¿ˆìœ¼ë¡œ êµ¬ë¶„í•˜ì‹œë©´ ë©ë‹ˆë‹¤.',
          thinkingLabel: 'ì…ë ¥ ëŒ€ê¸° ì¤‘...',
        };
      } else if (a !== 'ì´ëŒ€ë¡œ ì§„í–‰' && a !== 'ê±´ë„ˆë›°ê¸°') {
        // ììœ  í…ìŠ¤íŠ¸ ì…ë ¥
        const newFeatures = parseFeatures(a);
        accumulatedFeatures = newFeatures;
        featureSelectionActive = false;
        const selectedList = accumulatedFeatures.map(f => `âœ… ${f.name}`).join('\n');
        return {
          message: `**ì…ë ¥ ê¸°ëŠ¥ ${accumulatedFeatures.length}ê°œ ë°˜ì˜ ì™„ë£Œ:**\n${selectedList}`,
          thinkingLabel: 'ê¸°ëŠ¥ ëª©ë¡ ë°˜ì˜ ì¤‘...',
        };
      }

      featureSelectionActive = false;
      return { message: 'ê¸°ëŠ¥ ì •ë³´ë¥¼ ë°˜ì˜í–ˆìŠµë‹ˆë‹¤.', thinkingLabel: 'ë°˜ì˜ ì¤‘...' };
    }

    case 'referenceServices': {
      if (a === 'ê±´ë„ˆë›°ê¸°' || a.length < 3) {
        return { message: 'ë„˜ì–´ê°ˆê²Œìš”.' };
      }
      return {
        message: 'ì°¸ê³  ì„œë¹„ìŠ¤ë¥¼ ë°˜ì˜í–ˆìŠµë‹ˆë‹¤.',
        thinkingLabel: 'ë°˜ì˜ ì¤‘...',
      };
    }

    case 'techRequirements': {
      return {
        message: 'ê¸°ìˆ  ìš”êµ¬ì‚¬í•­ì„ ë°˜ì˜í–ˆìŠµë‹ˆë‹¤.',
        thinkingLabel: 'ë°˜ì˜ ì¤‘...',
      };
    }

    case 'budgetTimeline': {
      return {
        message: 'ì¼ì •/ì˜ˆì‚° ì •ë³´ë¥¼ ë°˜ì˜í–ˆìŠµë‹ˆë‹¤.',
        thinkingLabel: 'ë°˜ì˜ ì¤‘...',
      };
    }

    case 'additionalRequirements': {
      return {
        message: 'ì¶”ê°€ ìš”êµ¬ì‚¬í•­ì„ ë°˜ì˜í–ˆìŠµë‹ˆë‹¤.',
        thinkingLabel: 'ë°˜ì˜ ì¤‘...',
      };
    }

    default:
      return { message: 'ë‹µë³€ì„ ë°˜ì˜í–ˆìŠµë‹ˆë‹¤.' };
  }
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  ë°ì´í„° íŒŒì„œ (ê¸°ì¡´ ìœ ì§€)
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function parseTargetUsers(text: string): string {
  const t = text.trim();
  const segments: string[] = [];
  const ageMatch = t.match(/(\d{1,2})\s*[~\-ëŒ€]\s*(\d{1,2})?/);
  if (ageMatch) segments.push(`ì—°ë ¹ëŒ€: ${ageMatch[0]}`);
  const roles = ['ì§ì¥ì¸', 'í•™ìƒ', 'ì£¼ë¶€', 'í”„ë¦¬ëœì„œ', 'ì‚¬ì—…ì', 'ì†Œìƒê³µì¸', 'ê¸°ì—…', 'B2B', 'B2C', 'ê°œë°œì', 'ë””ìì´ë„ˆ', 'ë§ˆì¼€í„°', 'ì˜ì‚¬', 'í™˜ì', 'ì‹œë‹ˆì–´', 'ì–´ë¦°ì´', 'ë¶€ëª¨', 'ìì˜ì—…', 'ì°½ì—…ì', 'íˆ¬ìì'];
  for (const role of roles) { if (t.includes(role)) segments.push(role); }
  return segments.length > 0 ? `${t}\n\n[íƒ€ê²Ÿ ì„¸ê·¸ë¨¼íŠ¸: ${segments.join(', ')}]` : t;
}

function parseTechRequirements(text: string): string {
  const t = text.trim().toLowerCase();
  const techs: string[] = [];
  if (t.includes('ì•±') || t.includes('ëª¨ë°”ì¼') || t.includes('ios') || t.includes('ì•ˆë“œë¡œì´ë“œ') || t.includes('android')) techs.push('ëª¨ë°”ì¼ ì•± (iOS/Android)');
  if (t.includes('ì›¹') || t.includes('ì‚¬ì´íŠ¸') || t.includes('ë°˜ì‘í˜•')) techs.push('ì›¹ (ë°˜ì‘í˜•)');
  if (t.includes('ë‘˜') || t.includes('ë‹¤') || t.includes('ëª¨ë‘')) techs.push('ì›¹ + ëª¨ë°”ì¼ ì•± (í¬ë¡œìŠ¤í”Œë«í¼ ì¶”ì²œ)');
  return techs.length > 0 ? `${text.trim()}\n\n[í”Œë«í¼: ${techs.join(', ')}]` : text.trim();
}

function parseBudgetTimeline(text: string): string {
  const t = text.trim();
  const extras: string[] = [];
  const moneyPatterns = [/(\d{1,3}[,.]?\d{0,3})\s*ë§Œ\s*ì›/g, /(\d{1,3}[,.]?\d{0,3})\s*ì–µ/g, /(\d{1,4})\s*ë§Œ/g];
  for (const p of moneyPatterns) { for (const m of t.matchAll(p)) extras.push(m[0]); }
  const periodPatterns = [/(\d{1,2})\s*ê°œì›”/g, /(\d{1,2})\s*ì£¼/g, /(\d{4})\s*ë…„\s*(\d{1,2})\s*ì›”/g];
  for (const p of periodPatterns) { for (const m of t.matchAll(p)) extras.push(m[0]); }
  return extras.length > 0 ? `${t}\n\n[íŒŒì‹±: ${extras.join(', ')}]` : t;
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  ğŸ†• ë©”ì¸ í•¨ìˆ˜ v8 â€” ë™ì  ëŒ€í™” ì—”ì§„
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
export function generateFallbackResponse(
  userMessage: string,
  currentStep: number,
  rfpData?: RFPData
): FallbackResponse {
  const topicId = STEP_TO_TOPIC[currentStep] || 'overview';
  const trimmed = userMessage.trim();
  const isSkip = trimmed === 'ê±´ë„ˆë›°ê¸°';
  const isCoreFeatureFinalize = topicId === 'coreFeatures' && trimmed === 'ì´ëŒ€ë¡œ ì§„í–‰';

  // â”€â”€â”€ 1. RFP ë°ì´í„° ì—…ë°ì´íŠ¸ â”€â”€â”€
  let rfpUpdate: FallbackResponse['rfpUpdate'] = null;

  if (topicId === 'coreFeatures') {
    // ğŸ†• ê¸°ëŠ¥ ì„ íƒ â€” feedbackì—ì„œ accumulatedFeaturesë¥¼ ê´€ë¦¬í•˜ë¯€ë¡œ ì—¬ê¸°ì„œëŠ” ë‚˜ì¤‘ì— ì„¤ì •
    // rfpUpdateëŠ” feedback ì´í›„ì— ì„¤ì •ë¨
  } else if (!isSkip) {
    if (topicId === 'overview') {
      const { typeInfo } = detectProjectType(userMessage);
      rfpUpdate = { section: topicId, value: `${userMessage.trim()} â€” ${typeInfo.type} í”„ë¡œì íŠ¸` };
    } else if (topicId === 'targetUsers') {
      rfpUpdate = { section: topicId, value: parseTargetUsers(userMessage) };
    } else if (topicId === 'techRequirements') {
      rfpUpdate = { section: topicId, value: parseTechRequirements(userMessage) };
    } else if (topicId === 'budgetTimeline') {
      rfpUpdate = { section: topicId, value: parseBudgetTimeline(userMessage) };
    } else {
      rfpUpdate = { section: topicId, value: userMessage.trim() };
    }
  }

  // â”€â”€â”€ 2. í˜„ì¬ rfpData ì‹œë®¬ë ˆì´ì…˜ (ì„œë²„ì—ì„œ ì•ˆ ë³´ë‚´ì¤¬ì„ ë•Œ) â”€â”€â”€
  const simulatedRfpData: RFPData = rfpData || {
    overview: currentStep >= 1 ? previousAnswers[1] || '' : '',
    targetUsers: currentStep >= 2 ? previousAnswers[2] || '' : '',
    coreFeatures: currentStep >= 3 ? (previousAnswers[3] ? parseFeatures(previousAnswers[3]) : []) : [],
    referenceServices: currentStep >= 4 ? previousAnswers[4] || '' : '',
    techRequirements: currentStep >= 5 ? previousAnswers[5] || '' : '',
    budgetTimeline: currentStep >= 6 ? previousAnswers[6] || '' : '',
    additionalRequirements: currentStep >= 7 ? previousAnswers[7] || '' : '',
  };

  // rfpUpdate ë°˜ì˜
  if (rfpUpdate && !isSkip) {
    if (rfpUpdate.section === 'coreFeatures' && Array.isArray(rfpUpdate.value)) {
      simulatedRfpData.coreFeatures = rfpUpdate.value as RFPData['coreFeatures'];
    } else if (rfpUpdate.section in simulatedRfpData) {
      (simulatedRfpData as unknown as Record<string, unknown>)[rfpUpdate.section] = rfpUpdate.value;
    }
  }

  // â”€â”€â”€ 3. ì „ë¬¸ê°€ í”¼ë“œë°± â”€â”€â”€
  const feedback = getContextualFeedback(currentStep, userMessage, simulatedRfpData);

  // â”€â”€â”€ 3.5. ğŸ†• coreFeatures ëˆ„ì  ì²˜ë¦¬ (feedback ì´í›„) â”€â”€â”€
  if (topicId === 'coreFeatures') {
    if (accumulatedFeatures.length > 0) {
      rfpUpdate = { section: 'coreFeatures', value: accumulatedFeatures };
      simulatedRfpData.coreFeatures = accumulatedFeatures;
    } else if (isCoreFeatureFinalize || isSkip) {
      rfpUpdate = { section: 'coreFeatures', value: [] };
    }
  }

  // â”€â”€â”€ 4. ğŸ†• ë™ì  ë‹¤ìŒ í† í”½ ê²°ì • â”€â”€â”€
  let nextStepNumber = determineNextTopic(simulatedRfpData, currentStep);

  // ğŸ†• ê¸°ëŠ¥ ì„ íƒ ë©€í‹°ë¼ìš´ë“œ: ì•„ì§ ì„ íƒ ì¤‘ì´ë©´ coreFeaturesì— ë¨¸ë¬´ë¦„
  if (topicId === 'coreFeatures' && featureSelectionActive && !isCoreFeatureFinalize && !isSkip) {
    nextStepNumber = currentStep;
  }

  const shouldComplete = nextStepNumber === null;
  const covered = getTopicsCovered(simulatedRfpData);
  const progress = Math.round((covered.length / TOPICS.length) * 100);

  // â”€â”€â”€ 5. ì‘ë‹µ ì¡°í•© â”€â”€â”€
  let message: string;
  let quickReplies: string[] | undefined = feedback.quickReplies;
  let thinkingLabel: string | undefined = feedback.thinkingLabel;
  let selectableFeatures: SelectableFeature[] | undefined;

  if (shouldComplete) {
    // ì™„ë£Œ ìƒíƒœ
    const projectName = previousAnswers[1] ? previousAnswers[1].slice(0, 30) : 'í”„ë¡œì íŠ¸';
    const ti = detectedType;

    message = `${feedback.message}\n\n---\n\nğŸ‰ **"${projectName}" RFP ìƒì„± ì¤€ë¹„ ì™„ë£Œ!**\n\nğŸ“‹ ìˆ˜ì§‘ëœ ì •ë³´:\n${covered.map(t => {
      const topic = TOPICS.find(tp => tp.id === t);
      return topic ? `âœ… ${topic.icon} ${topic.label}` : '';
    }).filter(Boolean).join('\n')}${ti ? `\n\nğŸ“Š ì´ ${ti.type} í”„ë¡œì íŠ¸ ì¶”ì²œ MVP: ${ti.mvpScope}` : ''}\n\nì•„ë˜ ë²„íŠ¼ì„ ëˆŒëŸ¬ **ì „ë¬¸ PRD**ë¥¼ ì™„ì„±í•˜ì„¸ìš”!`;
    thinkingLabel = 'RFP ë¬¸ì„œ êµ¬ì¡° ì„¤ê³„ ì¤‘...';
  } else {
    // ë‹¤ìŒ ì§ˆë¬¸ìœ¼ë¡œ ì§„í–‰
    const nextQ = generateContextualQuestion(nextStepNumber!, simulatedRfpData);
    const nextTopic = TOPICS.find(t => t.stepNumber === nextStepNumber);
    const topicLabel = nextTopic ? `${nextTopic.icon} ${nextTopic.label}` : '';

    // ì™„ë£Œ ê°€ëŠ¥ ì—¬ë¶€ í‘œì‹œ
    const canCompleteNow = isReadyToComplete(simulatedRfpData);
    const completeHint = canCompleteNow ? '\n\nğŸ’¬ ì´ë¯¸ ì¶©ë¶„í•œ ì •ë³´ê°€ ìˆ˜ì§‘ë˜ì—ˆì–´ìš”. "RFP ìƒì„±"ì„ ëˆŒëŸ¬ ë°”ë¡œ ì™„ì„±í•  ìˆ˜ë„ ìˆìŠµë‹ˆë‹¤.' : '';

    message = `${feedback.message}\n\n---\n\n**${topicLabel}**\n${nextQ.question}${completeHint}`;
    quickReplies = feedback.quickReplies || nextQ.quickReplies;

    // ğŸ†• selectableFeatures ì „ë‹¬ (coreFeatures í† í”½ì¼ ë•Œ)
    if (nextQ.selectableFeatures) {
      selectableFeatures = nextQ.selectableFeatures;
      quickReplies = undefined; // selectableFeaturesê°€ ìˆìœ¼ë©´ quickReplies ìˆ¨ê¹€
    }

    if (canCompleteNow && quickReplies) {
      quickReplies = ['ë°”ë¡œ RFP ìƒì„±í•˜ê¸°', ...quickReplies];
    }
  }

  return {
    message,
    rfpUpdate,
    nextAction: shouldComplete ? 'complete' : 'continue',
    nextStep: nextStepNumber,
    quickReplies,
    selectableFeatures,
    thinkingLabel,
    topicsCovered: covered,
    progress,
    canComplete: isReadyToComplete(simulatedRfpData),
  };
}
